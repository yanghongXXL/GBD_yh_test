<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>GBD 笔记总结</title>

    <meta name="author" content="杨 弘" />
  
   <meta name="description" content="This book is an overview of how practitioners can acquire, wrangle, visualize, and model data with the R and Stan." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="GBD 笔记总结" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="<a href="https://yanghongxxl.github.com/GBD_yh_test/" class="uri">https://yanghongxxl.github.com/GBD_yh_test/</a>" />
  
  <meta property="og:description" content="This book is an overview of how practitioners can acquire, wrangle, visualize, and model data with the R and Stan." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="GBD 笔记总结" />
  
  <meta name="twitter:description" content="This book is an overview of how practitioners can acquire, wrangle, visualize, and model data with the R and Stan." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.1/transition.js"></script>
    <script src="libs/bs3compat-0.4.1/tabs.js"></script>
    <script src="libs/bs3compat-0.4.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">GBD 笔记总结</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="前言" class="section level1 unnumbered">
<h1 class="unnumbered">前言</h1>
<p>小菜鸟学习笔记，第一次尝试构建bookdown</p>
<!--chapter:end:index.Rmd-->
</div>
<div id="base_r基础" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Base_R基础</h1>
<div id="基础拾遗" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> 基础拾遗</h2>
<ol style="list-style-type: decimal">
<li><p>窗口可以通过拖动分割柱移动，也可以使用快捷键控制。比如：<strong>Ctrl+shift+1</strong>(2\3\4)</p></li>
<li><p>创建一个R脚本 ——<strong>Ctrl+shift+N</strong></p></li>
<li><p>快速注释——<strong>Ctrl+shift+C</strong></p></li>
<li><p>善于利用小标题实现功能分区（<strong>ctrl+shift+r</strong>）</p></li>
<li><p><strong>ctrl+alt+r</strong> ——快速插入代码框</p></li>
<li><p>注释（Ctrl+shift+c）； # ；</p></li>
<li><p>赋值（Alt+-）： =, &lt;- ;</p></li>
<li><p>函数的标志： ();</p></li>
<li><p>变量索引： $;</p></li>
<li><p>管道操作符： %&gt;%， |&gt;：读作 “然后” ;</p></li>
<li><p>比较或判断： &gt;, &lt; , &gt;=, &lt;=, ==, != ；</p></li>
<li><p>逻辑运算： &amp;(与), |(或), !(非) ;</p></li>
<li><p>算数运算： +， -， *， /, ^, %%(取余), %/%(整除)。</p></li>
</ol>
</div>
<div id="数据基本操作" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> 数据基本操作</h2>
<div id="读取数据" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> 读取数据</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/data.csv&quot;</span>) <span class="co"># 读取数据</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::kable(mydata, align = &quot;c&quot;)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mydata) <span class="co"># 查看表头</span></span></code></pre></div>
<pre><code>##  [1] &quot;measure&quot;  &quot;location&quot; &quot;sex&quot;      &quot;age&quot;     
##  [5] &quot;cause&quot;    &quot;metric&quot;   &quot;year&quot;     &quot;val&quot;     
##  [9] &quot;upper&quot;    &quot;lower&quot;</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mydata) <span class="co"># 查看数据结构</span></span></code></pre></div>
<pre><code>## spc_tbl_ [900 × 10] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ measure : chr [1:900] &quot;Prevalence&quot; &quot;Prevalence&quot; &quot;Prevalence&quot; &quot;Prevalence&quot; ...
##  $ location: chr [1:900] &quot;Global&quot; &quot;Global&quot; &quot;Global&quot; &quot;Global&quot; ...
##  $ sex     : chr [1:900] &quot;Male&quot; &quot;Female&quot; &quot;Both&quot; &quot;Male&quot; ...
##  $ age     : chr [1:900] &quot;All ages&quot; &quot;All ages&quot; &quot;All ages&quot; &quot;All ages&quot; ...
##  $ cause   : chr [1:900] &quot;HIV/AIDS&quot; &quot;HIV/AIDS&quot; &quot;HIV/AIDS&quot; &quot;HIV/AIDS&quot; ...
##  $ metric  : chr [1:900] &quot;Number&quot; &quot;Number&quot; &quot;Number&quot; &quot;Percent&quot; ...
##  $ year    : num [1:900] 1990 1990 1990 1990 1990 1990 1990 1990 1990 1990 ...
##  $ val     : num [1:900] 3.87e+06 3.96e+06 7.83e+06 1.50e-03 1.53e-03 ...
##  $ upper   : num [1:900] 4.40e+06 4.55e+06 8.85e+06 1.71e-03 1.76e-03 ...
##  $ lower   : num [1:900] 3.35e+06 3.40e+06 6.88e+06 1.30e-03 1.32e-03 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   measure = col_character(),
##   ..   location = col_character(),
##   ..   sex = col_character(),
##   ..   age = col_character(),
##   ..   cause = col_character(),
##   ..   metric = col_character(),
##   ..   year = col_double(),
##   ..   val = col_double(),
##   ..   upper = col_double(),
##   ..   lower = col_double()
##   .. )
##  - attr(*, &quot;problems&quot;)=&lt;externalptr&gt;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mydata<span class="sc">$</span>cause) <span class="co"># 查看分类变量的取值（唯一值）</span></span></code></pre></div>
<pre><code>## [1] &quot;HIV/AIDS&quot;                                     
## [2] &quot;Sexually transmitted infections excluding HIV&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 其他查看数据的函数</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mydata)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># head(mydata)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tail(mydata)</span></span></code></pre></div>
</div>
<div id="选择数据" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> 选择数据</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mydata2 <span class="ot">&lt;-</span> mydata <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause <span class="sc">==</span> <span class="st">&quot;HIV/AIDS&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>mydata2</span></code></pre></div>
<pre><code>## # A tibble: 15 × 10
##   measure    location sex    age     cause metric  year
##   &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 Prevalence Global   Male   All ag… HIV/… Number  2019
## 2 Prevalence Global   Female All ag… HIV/… Number  2019
## 3 Prevalence Global   Both   All ag… HIV/… Number  2019
## 4 Prevalence Global   Male   All ag… HIV/… Perce…  2019
## 5 Prevalence Global   Female All ag… HIV/… Perce…  2019
## 6 Prevalence Global   Both   All ag… HIV/… Perce…  2019
## # … with 9 more rows, and 3 more variables: val &lt;dbl&gt;,
## #   upper &lt;dbl&gt;, lower &lt;dbl&gt;</code></pre>
<p>这里面出现了管道操作符号” |&gt; “, 这个符号读作：然后。所以这个语句的意思是：首先，选中 mydata，然后，选择 cause 为”HIV/AIDS” 的行，然后，选择年份为 2019 年的行，最后，将选择好的数据赋值给 mydata2。</p>
<p>特别注意： = 是赋值符， == 为判断符。</p>
</div>
<div id="保存数据" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> 保存数据</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mydata2, <span class="co"># 将 mydata2 这个数据</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;HIV.csv&quot;</span>) <span class="co"># 保存为 HIV.csv 文件</span></span></code></pre></div>
</div>
</div>
<div id="数据类型与数据结构" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> 数据类型与数据结构</h2>
<div id="常见的数据类型" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> 常见的数据类型</h3>
<p>R 语言常见数据类型有：数值类型（numeric），字符串（character），逻辑（logical），其他： POSIXct,POSIXt 等。</p>
<ul>
<li>数值类型： 1， 2， 3， 4.5,3.8;</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fl">4.5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<ul>
<li>字符串类型：“字符”， “123”， “ASIR”， “HIV”</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="st">&quot;123&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="st">&quot;ASIR&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<ul>
<li>逻辑： TRUE， FALSE, T, F;</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(T)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
</div>
<div id="特殊数据类型-naninf-na-null" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> 特殊数据类型： NaN,Inf， NA， NULL</h3>
<ul>
<li><p>NaN:Not a number, 计算出错时候出现，比如 0/0,Inf/Inf</p></li>
<li><p>Inf : 无穷</p></li>
<li><p>NA：not availabel，缺失值。 NA 值具有传染性，任何数值与之发生关系均会变为 NA</p></li>
<li><p>NULL：空值。空值与 NA 的区别：比如一个教室稀稀拉拉坐了十几个学生，那么没有学生的位置可以视为缺失，而空值表示连座位也没有。</p></li>
</ul>
</div>
<div id="数据类型的转换" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> 数据类型的转换</h3>
<ul>
<li>numeric 与 logical 可以转化为 character，而 character 转化为 numeric 或者 logical 有可能出错，产生 NA 值。</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">1990</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="st">&quot;1990&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="st">&quot;ABC&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: 强制改变过程中产生了NA</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<ul>
<li>logical 可以转化为数值 0/1, 而在进行逻辑判断的时候， 0/1 也会被认为是 F/T</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="数据结构" class="section level3" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> 数据结构</h3>
<ul>
<li>标量</li>
</ul>
<p>单个元素组成的数据结构，比如”A”,123,TRUE 等。</p>
<p>### 向量</p>
<p>多个标量组成的一维的数据结构，比如 Vector。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成向量</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1990</span><span class="sc">:</span><span class="dv">2019</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>##  [1] 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999
## [11] 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009
## [21] 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;A&quot;</span>,<span class="dv">3</span>) <span class="co">#repeat 前三个字母</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;A&quot;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="dv">10</span>,<span class="at">by=</span><span class="dv">2</span>) <span class="co">#sequence 前三个字母</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 1 3 5 7 9</code></pre>
<ul>
<li><p>矩阵 (matrix)，数据框 (data.frame)， tipple</p></li>
<li><p>列表 (list) 与数组 (array)</p></li>
</ul>
</div>
</div>
<div id="作业" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> 作业</h2>
<ul>
<li>查看 data.csv 数据, 说出这个数据的性别有多少种？</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/data.csv&quot;</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(data<span class="sc">$</span>sex)</span></code></pre></div>
<pre><code>## [1] &quot;Male&quot;   &quot;Female&quot; &quot;Both&quot;</code></pre>
<ul>
<li>从 data.csv 文档选择年龄标准化 患病率数据。</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">==</span> <span class="st">&quot;Age-standardized&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;Rate&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 180 × 10
##   measure locat…¹ sex   age   cause metric  year    val
##   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Preval… Global  Male  Age-… HIV/… Rate    1990   148.
## 2 Preval… Global  Fema… Age-… HIV/… Rate    1990   147.
## 3 Preval… Global  Both  Age-… HIV/… Rate    1990   147.
## 4 Preval… Global  Male  Age-… Sexu… Rate    1990 11293.
## 5 Preval… Global  Fema… Age-… Sexu… Rate    1990 19439.
## 6 Preval… Global  Both  Age-… Sexu… Rate    1990 15387.
## # … with 174 more rows, 2 more variables: upper &lt;dbl&gt;,
## #   lower &lt;dbl&gt;, and abbreviated variable name
## #   ¹​location</code></pre>
<ul>
<li>从 data.csv 文档选择患病人数数据。</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;Number&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 180 × 10
##   measure locat…¹ sex   age   cause metric  year    val
##   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Preval… Global  Male  All … HIV/… Number  1990 3.87e6
## 2 Preval… Global  Fema… All … HIV/… Number  1990 3.96e6
## 3 Preval… Global  Both  All … HIV/… Number  1990 7.83e6
## 4 Preval… Global  Male  All … Sexu… Number  1990 2.71e8
## 5 Preval… Global  Fema… All … Sexu… Number  1990 4.74e8
## 6 Preval… Global  Both  All … Sexu… Number  1990 7.46e8
## # … with 174 more rows, 2 more variables: upper &lt;dbl&gt;,
## #   lower &lt;dbl&gt;, and abbreviated variable name
## #   ¹​location</code></pre>
<ul>
<li>从 data.csv 文档中选择 1990 到 2010 年艾滋病的女性患病率数据，并写出为 HIV_female.csv 文档。</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1990</span><span class="sc">:</span><span class="dv">2010</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause <span class="sc">==</span> <span class="st">&quot;HIV/AIDS&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;Rate&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;data/HIV_female.csv&quot;</span>)</span></code></pre></div>
<ul>
<li>从 data.csv 文档中选择 1990,1995,2000,2005,2010,2015年男性、女性其他传染性疾病患病率数据，并写出为 nonHIV.csv 文档</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">1995</span>, <span class="dv">2000</span>, <span class="dv">2005</span>, <span class="dv">2010</span>, <span class="dv">2015</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause <span class="sc">!=</span> <span class="st">&quot;HIV/AIDS&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">&quot;Rate&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;data/nonHIV.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="函数" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> 函数</h2>
<div id="函数的结构" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> 函数的结构</h3>
<p>R 语言函数一般由三个部分构成：函数体（body），参数（formals） , 环境（environment）。可以通过相应的函数查看函数的相应部分。以常见的 “粘贴” 函数 paste() 为例：</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># paste() 函数可以将两个向量对应的元素粘贴在一起。</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">paste</span>(a,b,<span class="at">sep =</span> <span class="st">&quot;:&quot;</span>,<span class="at">collapse =</span> <span class="cn">NULL</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>## [1] &quot;A:1&quot; &quot;B:2&quot; &quot;C:3&quot;</code></pre>
<p>我们分别使用 body， formals, environment 函数查看 paste() 函数的相应部分。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看函数结构</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(paste)</span></code></pre></div>
<pre><code>## .Internal(paste(list(...), sep, collapse, recycle0))</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看函数参数</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(paste)</span></code></pre></div>
<pre><code>## $...
## 
## 
## $sep
## [1] &quot; &quot;
## 
## $collapse
## NULL
## 
## $recycle0
## [1] FALSE</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看函数来自哪个包</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(paste)</span></code></pre></div>
<pre><code>## &lt;environment: namespace:base&gt;</code></pre>
</div>
<div id="函数的功能" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> 函数的功能</h3>
<p>函数就像一个加工厂，可以将 “原料” 通过一系列转变，然后输出相应的 “产品”</p>
<div class="figure">
<img src="images/0101.png" fig-align="center" alt="" />
<p class="caption">函数展示</p>
</div>
<p>这里的输入，可以是某个值、向量、 data.frame，或者是其他类型的数据；</p>
<p>输出，可以是数据，文档，图片等等。</p>
</div>
<div id="函数的分类" class="section level3" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> 函数的分类</h3>
<p>R 语言的函数包括内置函数，外来函数（R 包），自编函数三大类。</p>
<ul>
<li>实用的内置函数</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看R语言自带数据集</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>()</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 描述性统计类</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>()</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>()</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>()</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>()</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>()</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成随机数</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">runif</span>(<span class="at">n =</span> , <span class="at">min =</span> , <span class="at">max =</span> ) <span class="co"># uniform，生成 n 个服从均匀分布的小数</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">runif</span>(<span class="at">n=</span>,<span class="at">min=</span>,<span class="at">max=</span>),<span class="co"># round() 函数空值小数点的位数</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">0</span>)<span class="co"># 生成 n 个服从均匀分布的整数</span></span></code></pre></div>
<ul>
<li>实用的外来函数（tidyverse）</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据变量取值进行筛选</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>()</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 选择变量</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>()</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成变量</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>()</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 排序</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组统计</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>()</span></code></pre></div>
<ul>
<li>演示（使用R自带数据）</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载数据</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ToothGrowth&quot;</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看表头</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## [1] &quot;len&quot;  &quot;supp&quot; &quot;dose&quot;</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看数据结构</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: Factor w/ 2 levels &quot;OJ&quot;,&quot;VC&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看分组变量的取值</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(ToothGrowth<span class="sc">$</span>supp)</span></code></pre></div>
<pre><code>## [1] VC OJ
## Levels: OJ VC</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成变量（生成两个标签）</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>ToothGrowth <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(剂量<span class="ot">=</span><span class="fu">ifelse</span>(dose<span class="sc">==</span><span class="fl">0.5</span>,<span class="st">&quot;0.5mg&quot;</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ifelse</span>(dose<span class="sc">==</span><span class="fl">1.0</span>,<span class="st">&quot;1.0mg&quot;</span>,<span class="st">&quot;2.0mg&quot;</span>))) <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(补充喂养<span class="ot">=</span><span class="fu">ifelse</span>(supp<span class="sc">==</span><span class="st">&quot;VC&quot;</span>,<span class="st">&quot; 维 C&quot;</span>,<span class="st">&quot; 橙汁&quot;</span>))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组统计</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>summary_data <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(补充喂养, 剂量) <span class="sc">|&gt;</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean=</span><span class="fu">mean</span>(len),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd=</span><span class="fu">sd</span>(len))</span></code></pre></div>
<ul>
<li>自编函数</li>
</ul>
</div>
<div id="查看函数帮助" class="section level3" number="1.5.4">
<h3><span class="header-section-number">1.5.4</span> 查看函数帮助</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果知道具体的函数名字：</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>? <span class="co"># 查看函数的帮助，比如 ?filter</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>() <span class="co"># 同？</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>?? <span class="co"># 查看 R 包的帮助，比如??dplyr</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果不知道具体的函数名字</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">apropos</span>(<span class="st">&quot;norm&quot;</span>)<span class="co"># apropos: 就... 而言</span></span></code></pre></div>
</div>
</div>
<div id="向量及其操作" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> 向量及其操作</h2>
<p>向量为一系列标量的集合</p>
<div id="创建向量" class="section level3" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> 创建向量</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>()</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>()</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>()</span></code></pre></div>
</div>
<div id="向量的类型" class="section level3" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> 向量的类型</h3>
<ul>
<li>字符串，数值， logical 类型</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 字符串型：</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;C&quot;</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 数值类型</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># logical 类型</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(T,T,F,F)</span></code></pre></div>
<ul>
<li>因子类型</li>
</ul>
<p>R 语言有一类非常重要的变量类型，名为因子（factor）。因子可以视为分类变量的特殊类型，它既有值，又对值进行了排序（levels）。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如何生成因子</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>name1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>name2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(name1,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="co">#levels 必须与原始数据取值相同</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Both&quot;</span>)) <span class="co">#labels 是为了</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(name1)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(name2)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
</div>
<div id="向量的运算" class="section level3" number="1.6.3">
<h3><span class="header-section-number">1.6.3</span> 向量的运算</h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 简单统计</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(a)</span></code></pre></div>
<pre><code>## [1] 10.5</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 算数运算</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>a <span class="co"># 标量与向量</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> b<span class="sc">+</span>a <span class="co"># 标量与向量</span></span></code></pre></div>
</div>
<div id="重要向量的循环补齐机制" class="section level3" number="1.6.4">
<h3><span class="header-section-number">1.6.4</span> 重要：向量的循环补齐机制</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">paste</span>(a,b,<span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>## [1] &quot;A:1&quot; &quot;B:2&quot; &quot;C:3&quot; &quot;D:1&quot; &quot;E:2&quot;</code></pre>
<div class="figure">
<img src="images/0102.png" fig-align="center" alt="" />
<p class="caption">循环补齐</p>
</div>
</div>
<div id="交并补" class="section level3" number="1.6.5">
<h3><span class="header-section-number">1.6.5</span> 交、并、补</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 向量的交、并、补集，找不同，找相同，找不同（背熟）</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 取交集</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">intersect</span>(a,b) </span></code></pre></div>
<pre><code>## [1] 10 11 12 13 14 15</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 取并集</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(a,b)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
## [18] 18 19 20</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 找不同</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(a,b)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7 8 9</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(b,a)</span></code></pre></div>
<pre><code>## [1] 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 去除重复</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>aa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;A&quot;</span>,<span class="dv">3</span>),<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(aa)</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</code></pre>
</div>
<div id="向量的下标索引" class="section level3" number="1.6.6">
<h3><span class="header-section-number">1.6.6</span> 向量的下标索引</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 已经知道向量 x</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot; 张三&quot;</span>,<span class="st">&quot; 小明&quot;</span>,<span class="st">&quot; 王五&quot;</span>,<span class="st">&quot; 李思齐&quot;</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 如何选择李思齐？</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] &quot; 李思齐&quot;</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如何同时选择小明与李思齐？</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>x[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]</span></code></pre></div>
<pre><code>## [1] &quot; 小明&quot;   &quot; 李思齐&quot;</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如何不选择张三</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>x[<span class="sc">-</span><span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot; 小明&quot;   &quot; 王五&quot;   &quot; 李思齐&quot;</code></pre>
</div>
</div>
<div id="数据框及其操作" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> 数据框及其操作</h2>
<p>数据框是 R 语言最常用的二维表。</p>
<div id="生成数据框" class="section level3" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> 生成数据框</h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 通过 read.csv 函数等读取</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>()</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 通过向量组合生成</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">18</span>,<span class="dv">26</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot; 赵&quot;</span>,<span class="st">&quot; 钱&quot;</span>,<span class="st">&quot; 孙&quot;</span>,<span class="st">&quot; 李&quot;</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">99</span>,<span class="dv">65</span>,<span class="dv">77</span>,<span class="dv">88</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age=</span>age,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">name=</span>name,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">score=</span>score)</span></code></pre></div>
</div>
<div id="数据框的下标索引" class="section level3" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> 数据框的下标索引</h3>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据框下标索引中间有逗号，逗号前表示行，逗号后表示列 [row,col]</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 选择 df 前两列</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">2</span>] <span class="co"># 空着表示全选</span></span></code></pre></div>
<pre><code>## [1] &quot; 赵&quot; &quot; 钱&quot; &quot; 孙&quot; &quot; 李&quot;</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">2</span>,] <span class="co"># 选择 df 前两行</span></span></code></pre></div>
<pre><code>##   age name score
## 2  30   钱    65</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">2</span>,<span class="dv">2</span>] <span class="co"># 选择 df 第二行第二列</span></span></code></pre></div>
<pre><code>## [1] &quot; 钱&quot;</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df[<span class="sc">-</span><span class="dv">3</span>,] <span class="co"># 不选择第三行</span></span></code></pre></div>
<pre><code>##   age name score
## 1  20   赵    99
## 2  30   钱    65
## 4  26   李    88</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),<span class="dv">2</span>] <span class="co"># 选择 1， 3 行； 2 列</span></span></code></pre></div>
<pre><code>## [1] &quot; 赵&quot; &quot; 孙&quot;</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>name<span class="sc">==</span><span class="st">&quot; 李&quot;</span>,] <span class="co"># 选择姓李的数据</span></span></code></pre></div>
<pre><code>##   age name score
## 4  26   李    88</code></pre>
</div>
<div id="数据框如何生成新的列" class="section level3" number="1.7.3">
<h3><span class="header-section-number">1.7.3</span> 数据框如何生成新的列</h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 比如生成身高数据</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">178</span>,<span class="dv">180</span>,<span class="dv">169</span>,<span class="dv">175</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>height <span class="ot">&lt;-</span> height</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   age name score height
## 1  20   赵    99    178
## 2  30   钱    65    180
## 3  18   孙    77    169
## 4  26   李    88    175</code></pre>
</div>
</div>
<div id="作业-1" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> 作业</h2>
<ul>
<li>查看函数帮助，说出 paste() 与 paste0() 的差别， sep 和 collapse 参数的作用。</li>
</ul>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>?paste</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>?paste0</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># paste 比 paste0() 多了一个参数： sep</span></span></code></pre></div>
<p>sep 和 collapse 参数的作用:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数形式 paste (..., sep = &quot; &quot;, collapse =NULL)</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 示例</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sep 参数指定某个连接符，比如这里制定了下划线</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(a,b,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>,<span class="at">collapse =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1_A&quot; &quot;2_B&quot; &quot;3_C&quot; &quot;4_D&quot;</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collapse 参数默认为 NULL，</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果是其他值，向量就会坍缩成一个字符串标量</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(a,b,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>,<span class="at">collapse =</span> <span class="st">&quot;:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1_A:2_B:3_C:4_D&quot;</code></pre>
<ul>
<li>加载 R 内置数据 ToothGrowth, 按照喂养方式与剂量分组统计不同组牙齿生长长度的均值，标准差，中位数，四分位间距，最小值，最大值，以及老鼠的个数。</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ToothGrowth&quot;</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: Factor w/ 2 levels &quot;OJ&quot;,&quot;VC&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组统计</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span> </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(supp, dose) <span class="sc">|&gt;</span> </span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">len_mean =</span> <span class="fu">mean</span>(len),</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">len_sd =</span> <span class="fu">round</span>(<span class="fu">sd</span>(len), <span class="dv">1</span>),</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">len_median =</span> <span class="fu">median</span>(len),</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">len_IQR_lower =</span> <span class="fu">quantile</span>(len, <span class="fl">0.25</span>),</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">len_IQR_upper =</span> <span class="fu">quantile</span>(len, <span class="fl">0.75</span>),</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">len_min =</span> <span class="fu">min</span>(len),</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">len_max =</span> <span class="fu">max</span>(len),</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">mice_number =</span> <span class="fu">n</span>())</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(temp) <span class="co"># 展示数据</span></span></code></pre></div>
<table>
<colgroup>
<col width="5%" />
<col width="5%" />
<col width="9%" />
<col width="7%" />
<col width="11%" />
<col width="15%" />
<col width="15%" />
<col width="8%" />
<col width="8%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">supp</th>
<th align="right">dose</th>
<th align="right">len_mean</th>
<th align="right">len_sd</th>
<th align="right">len_median</th>
<th align="right">len_IQR_lower</th>
<th align="right">len_IQR_upper</th>
<th align="right">len_min</th>
<th align="right">len_max</th>
<th align="right">mice_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">OJ</td>
<td align="right">0.5</td>
<td align="right">13.23</td>
<td align="right">4.5</td>
<td align="right">12.25</td>
<td align="right">9.70</td>
<td align="right">16.18</td>
<td align="right">8.2</td>
<td align="right">21.5</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">OJ</td>
<td align="right">1.0</td>
<td align="right">22.70</td>
<td align="right">3.9</td>
<td align="right">23.45</td>
<td align="right">20.30</td>
<td align="right">25.65</td>
<td align="right">14.5</td>
<td align="right">27.3</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">OJ</td>
<td align="right">2.0</td>
<td align="right">26.06</td>
<td align="right">2.7</td>
<td align="right">25.95</td>
<td align="right">24.57</td>
<td align="right">27.07</td>
<td align="right">22.4</td>
<td align="right">30.9</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">VC</td>
<td align="right">0.5</td>
<td align="right">7.98</td>
<td align="right">2.7</td>
<td align="right">7.15</td>
<td align="right">5.95</td>
<td align="right">10.90</td>
<td align="right">4.2</td>
<td align="right">11.5</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">VC</td>
<td align="right">1.0</td>
<td align="right">16.77</td>
<td align="right">2.5</td>
<td align="right">16.50</td>
<td align="right">15.28</td>
<td align="right">17.30</td>
<td align="right">13.6</td>
<td align="right">22.5</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">VC</td>
<td align="right">2.0</td>
<td align="right">26.14</td>
<td align="right">4.8</td>
<td align="right">25.95</td>
<td align="right">23.38</td>
<td align="right">28.80</td>
<td align="right">18.5</td>
<td align="right">33.9</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<ul>
<li>生成 1 到 100 范围差值为 5 的等差序列 a，生成 1 到一百万倍数为 10 的等比序列 b。</li>
</ul>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 等差序列</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>##  [1]  1  6 11 16 21 26 31 36 41 46 51 56 61 66 71 76 81
## [18] 86 91 96</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 等比序列</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">6</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>b</span></code></pre></div>
<pre><code>## [1] 1e+00 1e+01 1e+02 1e+03 1e+04 1e+05 1e+06</code></pre>
<ul>
<li>已知向量 a=c(1:18),b=c(5:36), 用两种方法找到只存在 a,b 某一个向量中的所有元素。</li>
</ul>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法一 </span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co"># duplicated() 函数判断一个向量每个元素是否重复，并生成一个逻辑向量</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">36</span>)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)<span class="co">#5:18 存在重复的元素</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> c[<span class="sc">!</span><span class="fu">duplicated</span>(c)]</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
## [18] 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
## [35] 35 36</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法二：使用 unique() 函数</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique() 函数可以直接去重</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>b<span class="ot">=</span><span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">36</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)<span class="co">#5:18 存在重复的元素</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">unique</span>(c)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
## [18] 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
## [35] 35 36</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法三：使用 setdiff() 函数：</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># setdiff() 函数可以找到 a 或 b 互为补充的部分</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>b<span class="ot">=</span><span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">36</span>)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(a,b)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(c,b)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
## [18] 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
## [35] 35 36</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(b,a)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(a,c)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>c</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
## [18] 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
## [35] 35 36</code></pre>
<ul>
<li>将 data.csv 的年龄，年份都设置为因子。</li>
</ul>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/data.csv&quot;</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R 默认按照数值或字母先后顺序排序，因此这里不需要设定 levels</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 但是其他离散的分类变量，一定要检查顺序对不对，设定好 levels</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">factor</span>(temp<span class="sc">$</span>year)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">factor</span>(temp<span class="sc">$</span>age)</span></code></pre></div>
<ul>
<li>在 data.csv 中选择年龄标准化患病率数据，然后生成一列变量 se(标准误）。提示：根据正态性假设，标准误与区间存在以下关系： se=（区间上限-区间下限） /（2*1.96）。</li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>temp <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">==</span> <span class="st">&#39;Age-standardized&#39;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se =</span> (upper<span class="sc">-</span> lower)<span class="sc">/</span>(<span class="fl">1.96</span><span class="sc">*</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## # A tibble: 360 × 11
##   measure    location sex    age     cause metric year 
##   &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt;
## 1 Prevalence Global   Male   Age-st… HIV/… Perce… 1990 
## 2 Prevalence Global   Female Age-st… HIV/… Perce… 1990 
## 3 Prevalence Global   Both   Age-st… HIV/… Perce… 1990 
## 4 Prevalence Global   Male   Age-st… HIV/… Rate   1990 
## 5 Prevalence Global   Female Age-st… HIV/… Rate   1990 
## 6 Prevalence Global   Both   Age-st… HIV/… Rate   1990 
## # … with 354 more rows, and 4 more variables:
## #   val &lt;dbl&gt;, upper &lt;dbl&gt;, lower &lt;dbl&gt;, se &lt;dbl&gt;</code></pre>
<ul>
<li>在 data.csv 中生成年龄组变量（5 年间隔），如果年份在 1990 年到 1994年之间，生成 year2 为”year:1990-94”；如果年份在 1995 年到 1999 年之间，生成”year:1995-99”, 以此类推。提示：使用 ifelse(test,yes,no) 函数。</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法一，用 ifelse：</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>temp <span class="sc">|&gt;</span> </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year2 =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1990</span><span class="sc">:</span><span class="dv">1994</span>),<span class="st">&quot;year:1990_94&quot;</span>,</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">1995</span><span class="sc">:</span><span class="dv">1999</span>),<span class="st">&quot;year:1995_99&quot;</span>,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2000</span><span class="sc">:</span><span class="dv">2004</span>),<span class="st">&quot;year:2000_04&quot;</span>,</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2005</span><span class="sc">:</span><span class="dv">2009</span>),<span class="st">&quot;year:2005_09&quot;</span>,</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2010</span><span class="sc">:</span><span class="dv">2014</span>),<span class="st">&quot;year:2010_14&quot;</span>,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;year:2015_19&quot;</span>))))))</span></code></pre></div>
<pre><code>## # A tibble: 900 × 11
##   measure    location sex    age     cause metric year 
##   &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt;
## 1 Prevalence Global   Male   All ag… HIV/… Number 1990 
## 2 Prevalence Global   Female All ag… HIV/… Number 1990 
## 3 Prevalence Global   Both   All ag… HIV/… Number 1990 
## 4 Prevalence Global   Male   All ag… HIV/… Perce… 1990 
## 5 Prevalence Global   Female All ag… HIV/… Perce… 1990 
## 6 Prevalence Global   Both   All ag… HIV/… Perce… 1990 
## # … with 894 more rows, and 4 more variables:
## #   val &lt;dbl&gt;, upper &lt;dbl&gt;, lower &lt;dbl&gt;, year2 &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 方法二，用 case_when:</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp <span class="sc">|&gt;</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">year2=</span><span class="fu">case_when</span>(year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">1990</span><span class="sc">:</span><span class="dv">1994</span>)<span class="sc">~</span><span class="st">&quot;year:1990_94&quot;</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>                       year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">1995</span><span class="sc">:</span><span class="dv">1999</span>)<span class="sc">~</span><span class="st">&quot;year:1995_99&quot;</span>,</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>                       year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2000</span><span class="sc">:</span><span class="dv">2004</span>)<span class="sc">~</span><span class="st">&quot;year:2000_04&quot;</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>                       year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2005</span><span class="sc">:</span><span class="dv">2009</span>)<span class="sc">~</span><span class="st">&quot;year:2005_09&quot;</span>,</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>                       year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2010</span><span class="sc">:</span><span class="dv">2014</span>)<span class="sc">~</span><span class="st">&quot;year:2010_14&quot;</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>                       year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">2015</span><span class="sc">:</span><span class="dv">2019</span>)<span class="sc">~</span><span class="st">&quot;year:2015_19&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="do">####### 正常计算OR #############</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co">#       患病  不患病</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co">#暴露     80     30</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co">#非暴露   20     70</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       患病  不患病</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="co">#暴露     0.8     0.3</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co">#非暴露   0.2     0.7</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 患病暴露比（odds） 0.8/0.2</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 不患病暴露比（odds） 0.3/0.7</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算OR值 (0.8/0.2)/(0.3/0.7)=9.33</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="do">#### 转换成logisttic计算 #######</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  y患病=1，不患病=0</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  x暴露=1，不暴露=0</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 由于是二分类变量 1-p(y=1)=p(y=0)</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       患病      不患病</span></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a><span class="co">#暴露     p(y=1)  p(y=0)</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a><span class="co">#非暴露  p&#39;(y=1)  p&#39;(y=0)</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a><span class="do">## (1)OR = [p(y=1)/p&#39;(y=1)]/[(p(y=0)/p&#39;(y=0))]=[p(y=1)/p(y=0)]/[p&#39;(y=1)/p&#39;(y=0)]</span></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a><span class="do">##    构建logistic方程 ln [P(y=1)/(1-P(y=1))] = bx+d  </span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a><span class="do">##    推出P(y=1)/(1-P(y=1))=P(y=1)/P(y=0)=exp(b*x+d)</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a><span class="do">## (2)暴露组 p(y=1)/p(y=0) = exp(b*1+d)</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a><span class="do">## (3)非暴露组 p&#39;(y=1)/p&#39;(y=0) = exp(b*0+d)=exp(d)</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 根据(1)推导代入(2)(3)得到</span></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a><span class="do">## OR=exp(b*1+d)/exp(d)=exp(b)</span></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a><span class="do">########### R语言模拟程序  ###########</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">80</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">20</span>),<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">30</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">70</span>))</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">100</span>))</span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x,y)</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>y,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>x,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df </span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;暴露&quot;</span>,<span class="st">&quot;患病&quot;</span>)</span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df2)</span></code></pre></div>
<pre><code>##     患病
## 暴露  0  1
##    0 70 20
##    1 30 80</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.8</span><span class="sc">/</span><span class="fl">0.2</span>)<span class="sc">/</span>(<span class="fl">0.3</span><span class="sc">/</span><span class="fl">0.7</span>)</span></code></pre></div>
<pre><code>## [1] 9.333</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>x,df<span class="sc">$</span>y)</span></code></pre></div>
<pre><code>##    
##      0  1
##   0 70 20
##   1 30 80</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(y<span class="sc">~</span>x,<span class="at">data =</span> df,<span class="at">family =</span> <span class="fu">binomial</span>())</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = y ~ x, family = binomial(), data = df)
## 
## Coefficients:
## (Intercept)           x1  
##       -1.25         2.23  
## 
## Degrees of Freedom: 199 Total (i.e. Null);  198 Residual
## Null Deviance:       277 
## Residual Deviance: 224   AIC: 228</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">9.333</span>)</span></code></pre></div>
<pre><code>## [1] 2.234</code></pre>
<!--chapter:end:01_语言基础.Rmd-->
</div>
</div>
<div id="统计基础" class="section level1" number="2">
<h1><span class="header-section-number">2</span> 统计基础</h1>
<div id="随机抽样与概率分布" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> 随机抽样与概率分布</h2>
<div id="随机抽样" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> 随机抽样</h3>
<p>R 语言内置的随机抽样函数： sample(vector,n,replace=T)。 其中vector为要抽样的总体，这里必须是向量， n为抽取的样本数，replace代表是否为有放回抽样，如果 replace=T, 则代表抽样是有放回的。</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 例如, 下面表示在 1 到 10 间进行 4 次有放回的抽样。</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">4</span>,<span class="at">replace=</span>T)</span></code></pre></div>
<pre><code>## [1] 10 10  3  9</code></pre>
<p>注意，上面 1 到 10 十个元素中，每个元素被抽取的概率都是相同的，如果需要对概率不同的事件进行模拟，还需要再增加 prob=c()参数。例如，某药物治疗某病成功的治愈的概率为0.3，稳定的概率为 0.6，恶化的概率为0.1，那对50 人进行治疗，疾病治愈、稳定、恶化的模拟如下：</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot; 治愈&quot;</span>,<span class="st">&quot; 稳定&quot;</span>,<span class="st">&quot; 恶化&quot;</span>),<span class="dv">50</span>,<span class="at">replace =</span> T,<span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.3</span>,<span class="fl">0.6</span>,<span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>##  [1] &quot; 稳定&quot; &quot; 稳定&quot; &quot; 治愈&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 治愈&quot;
##  [7] &quot; 治愈&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot;
## [13] &quot; 治愈&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot;
## [19] &quot; 治愈&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 治愈&quot; &quot; 治愈&quot; &quot; 恶化&quot;
## [25] &quot; 治愈&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot;
## [31] &quot; 稳定&quot; &quot; 稳定&quot; &quot; 稳定&quot; &quot; 治愈&quot; &quot; 治愈&quot; &quot; 治愈&quot;
## [37] &quot; 治愈&quot; &quot; 治愈&quot; &quot; 稳定&quot; &quot; 治愈&quot; &quot; 稳定&quot; &quot; 稳定&quot;
## [43] &quot; 稳定&quot; &quot; 恶化&quot; &quot; 恶化&quot; &quot; 恶化&quot; &quot; 治愈&quot; &quot; 恶化&quot;
## [49] &quot; 稳定&quot; &quot; 稳定&quot;</code></pre>
</div>
<div id="常见概率分布" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> 常见概率分布</h3>
<p>常见概率分布如伯努利分布，二项分布，多项分布，正态分布， t 分布，泊松分布等可以自行理解。</p>
</div>
</div>
<div id="t检验与多元线性回归分析" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> t检验与多元线性回归分析</h2>
<p>t 检验可以用于独立样本，两独立样本，配对样本均值的比较；使用 t 检验的前提是数据满足正态性（如果是两独立样本，则需要满足方差齐性）。</p>
<p>R 语言做 t 检验的函数为 stats 包的 t.test() 函数，我们查看一下这个函数 的帮助，看看里面有什么参数：</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>?t.test</span></code></pre></div>
<p>帮助文件中， t.test 的用法是这样描述的：</p>
<p><img src="images/0201.png" width="100%" style="display: block; margin: auto;" /></p>
<p>这里 t.test() 函数有两种用法，一种是 Default S3 method, 另外一种是 S3 method for class “formula”。</p>
<ul>
<li>Default method:</li>
</ul>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 比较男女性别身高的差异.</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>male <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="at">mean =</span> <span class="dv">178</span>,<span class="at">sd=</span><span class="dv">13</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>female <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="at">mean=</span><span class="dv">168</span>,<span class="at">sd=</span><span class="dv">12</span>)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(male,female,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative=</span><span class="st">&quot;two.side&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  male and female
## t = 4.6, df = 198, p-value = 7e-06
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##   4.763 11.820
## sample estimates:
## mean of x mean of y 
##     178.1     169.8</code></pre>
<ul>
<li>method for class “formula”(R 语言的公式： y~x):</li>
</ul>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 同样男女身高数据，生成 data.frame</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;male&quot;</span>,<span class="dv">100</span>),<span class="fu">rep</span>(<span class="st">&quot;female&quot;</span>,<span class="dv">100</span>))</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(male,female)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sex=</span>sex,</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">height=</span>height)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(height<span class="sc">~</span>sex,</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative=</span><span class="st">&quot;two.side&quot;</span>,</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>df)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  height by sex
## t = -4.6, df = 198, p-value = 7e-06
## alternative hypothesis: true difference in means between group female and group male is not equal to 0
## 95 percent confidence interval:
##  -11.820  -4.763
## sample estimates:
## mean in group female   mean in group male 
##                169.8                178.1</code></pre>
<p>但是在 t 检验之前，我们还需要判断两组数据是否满足正态性，方差齐两个条件。</p>
<ul>
<li>正态性检验，使用shapiro.test()函数</li>
</ul>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># H0：数据满足正态， H1：数据不满足正态</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(male)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  male
## W = 0.99, p-value = 0.6</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(female)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  female
## W = 0.99, p-value = 0.8</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: 方差齐； H1: 方差不齐</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(height<span class="sc">~</span>sex,<span class="at">data=</span>df)</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##        Df F value Pr(&gt;F)
## group   1       0   0.97
##       198</code></pre>
<p>所以两独立样本 t 检验的完整流程是怎么样子的：</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 正态性检验：</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(male)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(female)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 方差齐性检验；</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(height<span class="sc">~</span>sex,<span class="at">data=</span>df)</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.t 检验</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(height<span class="sc">~</span>sex, <span class="co"># 输入公式</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative=</span><span class="st">&quot;two.side&quot;</span>,<span class="co"># 双侧检验</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span>T, <span class="co"># 方差齐</span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>df) <span class="co"># 提供数据</span></span></code></pre></div>
<p>t 检验非常常见，但是高分文献中，除了非常严格遵循盲法、随机、对照原则的临床实验以外，以它作为主要统计方法，非常罕见，为什么？</p>
<p>主要原因包括：</p>
<p>1.t 检验（或者卡方等其他类型的检验）没有办法获得危险因素的效应值，比如这里，我们不能直观地看到性别对身高的效应值是多少；</p>
<p>2. 没有办法矫正混杂</p>
<p>我们通过 ToothGrowth 数据，看看混杂因素是怎么影响 t 检验的结果的。</p>
<p>加载并查看数据：</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ToothGrowth&quot;</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: Factor w/ 2 levels &quot;OJ&quot;,&quot;VC&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</code></pre>
<p>我们对不同辅食类型小鼠牙齿的长度进行比较：</p>
<p>首先比较总体：</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 总体</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(len<span class="sc">~</span>supp,</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span>T,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>ToothGrowth)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  len by supp
## t = 1.9, df = 58, p-value = 0.06
## alternative hypothesis: true difference in means between group OJ and group VC is not equal to 0
## 95 percent confidence interval:
##  -0.167  7.567
## sample estimates:
## mean in group OJ mean in group VC 
##            20.66            16.96</code></pre>
<p>我们看到总体似乎是没有差异的，因为 p&gt;0.05。但是除了辅食的不同，剂量也是非常重要的因素，我们按照剂量进行分层，分别进行不同剂量两种辅食的比较：</p>
<p>0.5mg 组：</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(dose<span class="sc">==</span><span class="fl">0.5</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(len<span class="sc">~</span>supp,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span>T,</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>df)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  len by supp
## t = 3.2, df = 18, p-value = 0.005
## alternative hypothesis: true difference in means between group OJ and group VC is not equal to 0
## 95 percent confidence interval:
##  1.77 8.73
## sample estimates:
## mean in group OJ mean in group VC 
##            13.23             7.98</code></pre>
<p>1.0mg 组：</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(dose <span class="sc">==</span> <span class="fl">1.0</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(len<span class="sc">~</span>supp,</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span>T,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>df)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  len by supp
## t = 4, df = 18, p-value = 8e-04
## alternative hypothesis: true difference in means between group OJ and group VC is not equal to 0
## 95 percent confidence interval:
##  2.841 9.019
## sample estimates:
## mean in group OJ mean in group VC 
##            22.70            16.77</code></pre>
<p>2.0mg 组：</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span> </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(dose <span class="sc">==</span> <span class="fl">2.0</span>)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(len<span class="sc">~</span>supp,</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span>T,</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>df)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  len by supp
## t = -0.046, df = 18, p-value = 1
## alternative hypothesis: true difference in means between group OJ and group VC is not equal to 0
## 95 percent confidence interval:
##  -3.723  3.563
## sample estimates:
## mean in group OJ mean in group VC 
##            26.06            26.14</code></pre>
<p>我们进行线性回归，将两个因素同时纳入模型：</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将剂量转变为 factor</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>ToothGrowth<span class="sc">$</span>dose <span class="ot">&lt;-</span> <span class="fu">factor</span>(ToothGrowth<span class="sc">$</span>dose,</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">1.0</span>,<span class="fl">2.0</span>),</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0.5mg&quot;</span>,<span class="st">&quot;1.0mg&quot;</span>,<span class="st">&quot;2.0mg&quot;</span>))</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 构建线性模型</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(len<span class="sc">~</span>supp<span class="sc">+</span>dose,</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">data=</span>ToothGrowth)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = len ~ supp + dose, data = ToothGrowth)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -7.08  -2.75  -0.80   2.45   9.65 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   12.455      0.988   12.60  &lt; 2e-16 ***
## suppVC        -3.700      0.988   -3.74  0.00043 ***
## dose1.0mg      9.130      1.210    7.54  4.4e-10 ***
## dose2.0mg     15.495      1.210   12.80  &lt; 2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.83 on 56 degrees of freedom
## Multiple R-squared:  0.762,  Adjusted R-squared:  0.75 
## F-statistic: 59.9 on 3 and 56 DF,  p-value: &lt;2e-16</code></pre>
<p>提取模型的估计结果：</p>
<ul>
<li>提取系数cofficients</li>
</ul>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>coef1 <span class="ot">&lt;-</span> fit<span class="sc">$</span>coefficients</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>coef2 <span class="ot">&lt;-</span> fit[<span class="dv">1</span>]</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>coef3 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>coef</span></code></pre></div>
<pre><code>## function (object, ...) 
## UseMethod(&quot;coef&quot;)
## &lt;bytecode: 0x000001f4db754ef8&gt;
## &lt;environment: namespace:stats&gt;</code></pre>
<p>提取系数的 95% 可信区间：</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>interval <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>interval</span></code></pre></div>
<pre><code>##              2.5 % 97.5 %
## (Intercept) 10.475  14.43
## suppVC      -5.680  -1.72
## dose1.0mg    6.705  11.55
## dose2.0mg   13.070  17.92</code></pre>
</div>
<div id="logistic回归" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> logistic回归</h2>
<div id="数据来源" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> 数据来源</h3>
<p>我们使用 MASS 包的 birthwt 数据作演示。 birthwt 数据是 1986 年在马萨诸塞州斯普林菲尔德 Baystate 医疗中心收集的，这个数据包括以下几个指标： low: 出生体重小于 2.5 公斤的指标, 如果小于 2.5 则为 1，反之则为 0；</p>
<p>age: 母亲生育时的年龄；</p>
<p>lwt: 母亲在最后一次月经时的体重 (磅);</p>
<p>race: 母亲的种族（1 = 白人， 2 = 黑人， 3 = 其他） ;</p>
<p>smoke: 怀孕期间的吸烟状况;</p>
<p>ptl: 既往早产的次数;</p>
<p>ht：是否有高血压病史;</p>
<p>ui：是否存在子宫刺激;</p>
<p>ftv: 在怀孕的前三个月, 医生看病的次数;</p>
<p>bwt: 出生体重, 以克计。</p>
</div>
<div id="获得并查看数据" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> 获得并查看数据</h3>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;birthwt&quot;</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(birthwt)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    189 obs. of  10 variables:
##  $ low  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ age  : int  19 33 20 21 18 21 22 17 29 26 ...
##  $ lwt  : int  182 155 105 108 107 124 118 103 123 113 ...
##  $ race : int  2 3 1 1 1 3 1 3 1 1 ...
##  $ smoke: int  0 0 1 1 1 0 0 0 1 1 ...
##  $ ptl  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ht   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ui   : int  1 0 0 1 1 0 0 0 0 0 ...
##  $ ftv  : int  0 3 1 2 0 0 1 1 1 0 ...
##  $ bwt  : int  2523 2551 2557 2594 2600 2622 2637 2637 2663 2665 ...</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(birthwt<span class="sc">$</span>low)</span></code></pre></div>
<pre><code>## [1] 0 1</code></pre>
</div>
<div id="清洗数据" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> 清洗数据</h3>
<p>这里主要是对分类变量进行转换，转换为 factor。</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> birthwt</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>low, </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>race,</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;black&quot;</span>,<span class="st">&quot;other&quot;</span>))</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>smoke,</span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>ht <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>ht,</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>ui <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>ui,</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span></code></pre></div>
</div>
<div id="构建全模型" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> 构建全模型</h3>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>##  [1] &quot;low&quot;   &quot;age&quot;   &quot;lwt&quot;   &quot;race&quot;  &quot;smoke&quot; &quot;ptl&quot;  
##  [7] &quot;ht&quot;    &quot;ui&quot;    &quot;ftv&quot;   &quot;bwt&quot;</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fix(a)</span></span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(low<span class="sc">~</span>age<span class="sc">+</span>lwt<span class="sc">+</span>race<span class="sc">+</span>smoke<span class="sc">+</span>ptl<span class="sc">+</span>ht<span class="sc">+</span>ui<span class="sc">+</span>ftv,</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),<span class="co"># 连接函数</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> df)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = low ~ age + lwt + race + smoke + ptl + ht + ui + 
##     ftv, family = binomial(link = &quot;logit&quot;), data = df)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.895  -0.821  -0.532   0.982   2.212  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  0.48062    1.19689    0.40   0.6880   
## age         -0.02955    0.03703   -0.80   0.4249   
## lwt         -0.01542    0.00692   -2.23   0.0258 * 
## raceblack    1.27226    0.52736    2.41   0.0158 * 
## raceother    0.88050    0.44078    2.00   0.0458 * 
## smokeYes     0.93885    0.40215    2.33   0.0196 * 
## ptl          0.54334    0.34540    1.57   0.1157   
## htYes        1.86330    0.69753    2.67   0.0076 **
## uiYes        0.76765    0.45932    1.67   0.0947 . 
## ftv          0.06530    0.17239    0.38   0.7048   
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 234.67  on 188  degrees of freedom
## Residual deviance: 201.28  on 179  degrees of freedom
## AIC: 221.3
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="使用逐步后退法获得最优模型aic信息量准则" class="section level3" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> 使用逐步后退法获得最优模型（AIC信息量准则）</h3>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(model)</span></code></pre></div>
<pre><code>## Start:  AIC=221.3
## low ~ age + lwt + race + smoke + ptl + ht + ui + ftv
## 
##         Df Deviance AIC
## - ftv    1      201 219
## - age    1      202 220
## &lt;none&gt;          201 221
## - ptl    1      204 222
## - ui     1      204 222
## - race   2      209 225
## - lwt    1      207 225
## - smoke  1      207 225
## - ht     1      209 227
## 
## Step:  AIC=219.4
## low ~ age + lwt + race + smoke + ptl + ht + ui
## 
##         Df Deviance AIC
## - age    1      202 218
## &lt;none&gt;          201 219
## - ptl    1      204 220
## - ui     1      204 220
## - race   2      209 223
## - lwt    1      207 223
## - smoke  1      207 223
## - ht     1      209 225
## 
## Step:  AIC=218
## low ~ lwt + race + smoke + ptl + ht + ui
## 
##         Df Deviance AIC
## &lt;none&gt;          202 218
## - ptl    1      204 218
## - ui     1      205 219
## - smoke  1      208 222
## - lwt    1      208 222
## - race   2      210 222
## - ht     1      210 224</code></pre>
<pre><code>## 
## Call:  glm(formula = low ~ lwt + race + smoke + ptl + ht + ui, family = binomial(link = &quot;logit&quot;), 
##     data = df)
## 
## Coefficients:
## (Intercept)          lwt    raceblack    raceother  
##     -0.0865      -0.0159       1.3257       0.8971  
##    smokeYes          ptl        htYes        uiYes  
##      0.9387       0.5032       1.8550       0.7857  
## 
## Degrees of Freedom: 188 Total (i.e. Null);  181 Residual
## Null Deviance:       235 
## Residual Deviance: 202   AIC: 218</code></pre>
</div>
<div id="最优模型" class="section level3" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> 最优模型</h3>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>model_best <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> low <span class="sc">~</span> lwt <span class="sc">+</span> race <span class="sc">+</span> smoke <span class="sc">+</span> ptl <span class="sc">+</span> ht <span class="sc">+</span> ui,</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> df)</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_best)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = low ~ lwt + race + smoke + ptl + ht + ui, family = binomial(link = &quot;logit&quot;), 
##     data = df)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.905  -0.812  -0.524   0.948   2.181  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -0.08655    0.95176   -0.09   0.9275   
## lwt         -0.01591    0.00686   -2.32   0.0203 * 
## raceblack    1.32572    0.52224    2.54   0.0111 * 
## raceother    0.89708    0.43388    2.07   0.0387 * 
## smokeYes     0.93873    0.39872    2.35   0.0186 * 
## ptl          0.50321    0.34123    1.47   0.1403   
## htYes        1.85504    0.69512    2.67   0.0076 **
## uiYes        0.78570    0.45644    1.72   0.0852 . 
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 234.67  on 188  degrees of freedom
## Residual deviance: 201.99  on 181  degrees of freedom
## AIC: 218
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="提取系数的or值与区间并写出" class="section level3" number="2.3.7">
<h3><span class="header-section-number">2.3.7</span> 提取系数的OR值与区间，并写出</h3>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取 OR 与区间并合并</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>or <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(model_best))<span class="co"># 系数</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>or_interval <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(model_best))</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>or <span class="ot">&lt;-</span> <span class="fu">cbind</span>(or,or_interval)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取其他值</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_best)</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp<span class="sc">$</span>coefficients</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(temp,or)</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(results,&quot;results.csv&quot;,row.names = T)</span></span></code></pre></div>
</div>
<div id="随手画一个列线图" class="section level3" number="2.3.8">
<h3><span class="header-section-number">2.3.8</span> 随手画一个列线图</h3>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;regplot&quot;)</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(regplot)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">regplot</span>(model_best)</span></code></pre></div>
<p><img src="images/0202.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="本章作业" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> 本章作业</h2>
<ol style="list-style-type: decimal">
<li>抛硬币，假设硬币两面密度不均， A 面向上的概率为 0.55， B 面向上的概率为 0.45，连续抛 50 次，模拟每次抛硬币的结果。</li>
</ol>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;正面&quot;</span>,<span class="st">&quot;反面&quot;</span>),</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>       <span class="dv">50</span>,</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">replace =</span> T,</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.55</span>,<span class="fl">0.45</span>))</span></code></pre></div>
<pre><code>##  [1] &quot;正面&quot; &quot;正面&quot; &quot;正面&quot; &quot;反面&quot; &quot;反面&quot; &quot;反面&quot; &quot;正面&quot;
##  [8] &quot;正面&quot; &quot;正面&quot; &quot;正面&quot; &quot;正面&quot; &quot;正面&quot; &quot;正面&quot; &quot;反面&quot;
## [15] &quot;反面&quot; &quot;正面&quot; &quot;反面&quot; &quot;反面&quot; &quot;反面&quot; &quot;正面&quot; &quot;正面&quot;
## [22] &quot;反面&quot; &quot;反面&quot; &quot;正面&quot; &quot;正面&quot; &quot;反面&quot; &quot;反面&quot; &quot;正面&quot;
## [29] &quot;正面&quot; &quot;反面&quot; &quot;正面&quot; &quot;正面&quot; &quot;正面&quot; &quot;反面&quot; &quot;正面&quot;
## [36] &quot;反面&quot; &quot;正面&quot; &quot;正面&quot; &quot;反面&quot; &quot;正面&quot; &quot;正面&quot; &quot;正面&quot;
## [43] &quot;正面&quot; &quot;反面&quot; &quot;正面&quot; &quot;反面&quot; &quot;反面&quot; &quot;反面&quot; &quot;正面&quot;
## [50] &quot;反面&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>使用 ToothGrowth 数据，将牙齿生长长度按照 18.8 分为两类，如果大于18.8 定义为阳性，否则定义为阴性，使用 logistic 回归分析辅食类型与剂量对阳性事件的影响。（提取 OR 等并且写出哦！）</li>
</ol>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ToothGrowth&quot;</span>)</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: Factor w/ 2 levels &quot;OJ&quot;,&quot;VC&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## [1] &quot;len&quot;  &quot;supp&quot; &quot;dose&quot;</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> ToothGrowth <span class="sc">|&gt;</span> </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">len2=</span><span class="fu">ifelse</span>(len<span class="sc">&gt;</span><span class="fl">18.8</span>,<span class="st">&quot;阳性&quot;</span>,<span class="st">&quot;阴性&quot;</span>))</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>len2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>len2,</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;阴性&quot;</span>,<span class="st">&quot;阳性&quot;</span>),</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;阴性&quot;</span>,<span class="st">&quot;阳性&quot;</span>))</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(len2<span class="sc">~</span>supp<span class="sc">+</span>dose,</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>df)</span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp<span class="sc">$</span>coefficients</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(fit))</span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>OR_interval <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(fit))</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> <span class="fu">cbind</span>(OR,OR_interval)</span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cbind</span>(temp,OR)</span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;D:/OneDrive - b.sxmu.edu.cn/03-yh学习/00-小论文/03-GBD/GBD_yh_test&quot;</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(result,&quot;logistic.csv&quot;,row.names = T)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>课后思考题：辅食类型与剂量是否存在交互效应？分别研究交互效应对len(线性模型) 与阳性事件（logistic 回归）的影响。</li>
</ol>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(len2<span class="sc">~</span>supp<span class="sc">+</span>dose<span class="sc">+</span>supp<span class="sc">:</span>dose, <span class="co">#写法1</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data=</span>df)</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(len2<span class="sc">~</span>supp<span class="sc">*</span>dose, <span class="co">#写法2</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>df)</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(len2<span class="sc">~</span>(supp<span class="sc">+</span>dose)<span class="sc">^</span><span class="dv">2</span>, <span class="co">#写法3</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>df)</span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 交互效应的解读</span></span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = len2 ~ (supp + dose)^2, family = binomial(link = &quot;logit&quot;), 
##     data = df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1680  -0.4242  -0.0654   0.4477   2.2148  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   -6.593      2.355   -2.80   0.0051 **
## suppVC        -0.382      3.227   -0.12   0.9057   
## dose           8.791      2.978    2.95   0.0032 **
## suppVC:dose   -4.178      3.296   -1.27   0.2049   
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 83.178  on 59  degrees of freedom
## Residual deviance: 26.220  on 56  degrees of freedom
## AIC: 34.22
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.看主效应：看主效应方向；主效应的方向代表这个向量对结局的影响；</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.看交互效应的方向：交互效应的方向代表了另外一个变量对该变量对结局影响的削弱或者增强。</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.一般只做两个变量的交互，没必要做更高阶的交互。</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.交互效应有没有必要放入模型？看P值；看AIC。</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="co"># anova(fit,fit3)</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit,fit3)</span></code></pre></div>
<pre><code>##      df   AIC
## fit   3 34.04
## fit3  4 34.22</code></pre>
<!--chapter:end:02_统计基础.Rmd-->
</div>
</div>
<div id="ggplot2图层语法与gbd数据展示一" class="section level1" number="3">
<h1><span class="header-section-number">3</span> ggplot2图层语法与GBD数据展示一</h1>
<div id="图层的基本概念" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> 图层的基本概念</h2>
<p>ggplot2 图层语法，可以类比于 photoshop 中图层的概念：</p>
<p><img src="images/0301.png" width="90%" style="display: block; margin: auto;" /></p>
<p>ggplot2 绘制的图形，也是由一个个图层叠加而成的。</p>
<p>每一个图层，都可以指定用于画图的数据，指定需要绘制的几何图案，以及图像的美学属性映射，包括颜色、坐标、位置、尺度等等；图层代码与图层 代码之间，则用加号”+“进行连接。</p>
<p>图层语法模板</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 加载 ggplot2 包</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 打开画板</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df1, <span class="co"># 指定数据</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x1,<span class="at">y=</span>y1,<span class="at">color=</span>group1))<span class="sc">+</span> <span class="co"># 美学属性映射</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 图层 1</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 图层 2</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data=</span>df2,<span class="fu">aes</span>(<span class="at">x=</span>x2,<span class="at">y=</span>y2,<span class="at">color=</span>group2))<span class="sc">+</span> </span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 其他</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continues</span>()<span class="sc">+</span> <span class="co"># 尺度设定</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>()<span class="sc">+</span> <span class="co"># 分面</span></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>() <span class="co"># 主题风格设定</span></span></code></pre></div>
</div>
<div id="ggplot2-基本元素" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> ggplot2 基本元素</h2>
<div id="数据" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> 数据</h3>
<p>画图第一件事，肯定是指定用于画图的数据。一般用于 ggplot2 画图的数据，是长数据 (整洁的数据)。</p>
</div>
<div id="几何图形" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> 几何图形</h3>
<p>统计图中最常见的几种几何图案：点、线、柱状图、条形图、直方图、误差图、箱图……</p>
<p>ggplot2 用 geometry 函数指定所需绘制的图案，比如 geom_point(),geom_line(),geom_bar(),geom_errorb</p>
<p>geom 是 geometry 的前四个字母， geom_ 下划线后连接几何图形比如point,bar,box 等。 geometry 函数可以设定不同的参数，包括坐标，位置，颜色，尺度等。</p>
</div>
<div id="美学属性映射" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> 美学属性映射</h3>
<p>美学的英文单词： aesthetic。 aes() 函数将某个变量的数据映射给某种美学属性。美学属性可以在画板处进行全局映射，也可以在某个图层中进行局部映射。</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 打开画板</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df1,</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x=</span>x1,<span class="at">y=</span>y1,<span class="at">color=</span>group1))<span class="sc">+</span> <span class="co"># 全局映射</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 图层 1</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()<span class="sc">+</span> <span class="co"># 受全局映射的控制</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 图层 2</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data=</span>df2,<span class="fu">aes</span>(<span class="at">x=</span>x2,<span class="at">y=</span>y2,<span class="at">group=</span>group2))<span class="sc">+</span> <span class="co">#局部映射不受控制</span></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 其他</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continues</span>()<span class="sc">+</span></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>()<span class="sc">+</span></span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>()</span></code></pre></div>
</div>
</div>
<div id="我的第一个图" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> 我的第一个图</h2>
<p>这里我们用 Global_HIV.csv 数据进行第一个图的绘制：</p>
<p>使用线图展示 <strong>1990 到 2019</strong> 年全球<strong>男</strong>、<strong>女</strong> <strong>HIV 发病人数</strong>的变化趋势。</p>
<div id="准备画图数据" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> 准备画图数据</h3>
<ul>
<li>加载需要的R包</li>
</ul>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<ul>
<li>读取数据</li>
</ul>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/Global_HIV.csv&quot;</span>)</span></code></pre></div>
<ul>
<li>查看数据</li>
</ul>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;measure&quot;  &quot;location&quot; &quot;sex&quot;      &quot;age&quot;     
##  [5] &quot;cause&quot;    &quot;metric&quot;   &quot;year&quot;     &quot;val&quot;     
##  [9] &quot;upper&quot;    &quot;lower&quot;</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>measure)</span></code></pre></div>
<pre><code>## [1] &quot;Deaths&quot;                                
## [2] &quot;YLLs (Years of Life Lost)&quot;             
## [3] &quot;Incidence&quot;                             
## [4] &quot;DALYs (Disability-Adjusted Life Years)&quot;
## [5] &quot;YLDs (Years Lived with Disability)&quot;    
## [6] &quot;Prevalence&quot;</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>sex)</span></code></pre></div>
<pre><code>## [1] &quot;Male&quot;   &quot;Female&quot; &quot;Both&quot;</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>##  [1] &quot;&lt;5 years&quot;         &quot;5-9 years&quot;       
##  [3] &quot;10-14 years&quot;      &quot;15-19 years&quot;     
##  [5] &quot;20-24 years&quot;      &quot;25-29 years&quot;     
##  [7] &quot;30-34 years&quot;      &quot;35-39 years&quot;     
##  [9] &quot;40-44 years&quot;      &quot;45-49 years&quot;     
## [11] &quot;50-54 years&quot;      &quot;55-59 years&quot;     
## [13] &quot;60-64 years&quot;      &quot;65-69 years&quot;     
## [15] &quot;70-74 years&quot;      &quot;75-79 years&quot;     
## [17] &quot;All ages&quot;         &quot;Age-standardized&quot;
## [19] &quot;80-84 years&quot;      &quot;85-89 years&quot;     
## [21] &quot;90-94 years&quot;      &quot;95+ years&quot;</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>cause)</span></code></pre></div>
<pre><code>## [1] &quot;HIV/AIDS and sexually transmitted infections&quot; 
## [2] &quot;HIV/AIDS&quot;                                     
## [3] &quot;Sexually transmitted infections excluding HIV&quot;
## [4] &quot;Syphilis&quot;                                     
## [5] &quot;Chlamydial infection&quot;                         
## [6] &quot;Gonococcal infection&quot;                         
## [7] &quot;Other sexually transmitted infections&quot;        
## [8] &quot;Trichomoniasis&quot;                               
## [9] &quot;Genital herpes&quot;</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>metric)</span></code></pre></div>
<pre><code>## [1] &quot;Number&quot;  &quot;Percent&quot; &quot;Rate&quot;</code></pre>
<ul>
<li>选择数据</li>
</ul>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;Incidence&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sex<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;All ages&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(cause<span class="sc">==</span><span class="st">&quot;HIV/AIDS&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(metric<span class="sc">==</span><span class="st">&quot;Number&quot;</span>)</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(temp)</span></code></pre></div>
<pre><code>## spc_tbl_ [60 × 10] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ measure : chr [1:60] &quot;Incidence&quot; &quot;Incidence&quot; &quot;Incidence&quot; &quot;Incidence&quot; ...
##  $ location: chr [1:60] &quot;Global&quot; &quot;Global&quot; &quot;Global&quot; &quot;Global&quot; ...
##  $ sex     : chr [1:60] &quot;Male&quot; &quot;Female&quot; &quot;Male&quot; &quot;Female&quot; ...
##  $ age     : chr [1:60] &quot;All ages&quot; &quot;All ages&quot; &quot;All ages&quot; &quot;All ages&quot; ...
##  $ cause   : chr [1:60] &quot;HIV/AIDS&quot; &quot;HIV/AIDS&quot; &quot;HIV/AIDS&quot; &quot;HIV/AIDS&quot; ...
##  $ metric  : chr [1:60] &quot;Number&quot; &quot;Number&quot; &quot;Number&quot; &quot;Number&quot; ...
##  $ year    : num [1:60] 1991 1991 1990 1990 1994 ...
##  $ val     : num [1:60] 1054341 1313369 919820 1137890 1334822 ...
##  $ upper   : num [1:60] 1226338 1579485 1063665 1371008 1582749 ...
##  $ lower   : num [1:60] 888662 1060693 780544 916513 1121995 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   measure = col_character(),
##   ..   location = col_character(),
##   ..   sex = col_character(),
##   ..   age = col_character(),
##   ..   cause = col_character(),
##   ..   metric = col_character(),
##   ..   year = col_double(),
##   ..   val = col_double(),
##   ..   upper = col_double(),
##   ..   lower = col_double()
##   .. )
##  - attr(*, &quot;problems&quot;)=&lt;externalptr&gt;</code></pre>
</div>
<div id="画图" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> 画图</h3>
<p>思考：我们想直观地对比男性、女性 HIV 发病人数发展变化趋势，需要将两条线放在同一个图案中，该怎么做？</p>
<p>方法：使用不同的颜色进行区分。用 ggplot2 美学属性映射的思维，就是将性别这个变量映射到颜色中去。</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> temp,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>val,<span class="at">color=</span>sex))<span class="sc">+</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>fig1</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-7-1.png" width="576" /></p>
</div>
<div id="如何查看-ggplot2-内部函数参数的种类及作用" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> 如何查看 ggplot2 内部函数参数的种类及作用？</h3>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>?ggplot</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>?aes</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>?geom_line</span></code></pre></div>
</div>
<div id="图片的保存" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> 图片的保存</h3>
<p>两种保存图片的方式：</p>
<p>1、使用 export 导出 (不推荐)；【直接再窗口保存，不推荐】</p>
<p>2、使用 ggsave() 函数导出：</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot; 我的第一个图.jpeg&quot;</span>,<span class="at">width =</span> <span class="dv">8</span>,<span class="at">height =</span> <span class="dv">6</span>,<span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="作业一" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> 作业一</h3>
<ol style="list-style-type: decimal">
<li>给 fig1 增加一个点图层，点为各个年份的发病人数，将每个点的大小设定为 1.2(size=1.2)，并将生成的图片对象赋值给 fig2。</li>
</ol>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> temp,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>val,<span class="at">color=</span>sex))<span class="sc">+</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span> <span class="fl">1.2</span>)</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>fig2</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-10-1.png" width="576" /></p>
<ol start="2" style="list-style-type: decimal">
<li>给 fig2 增加一个图层, 展示发病人数的 95%UI, 提示：geom_ribbon(aes(ymin=?,ymax=?)), 将 95%UI 的填充颜色按照性别区分（提示：将性别这个变量映射到填充颜色中去，设置 fill=?）；并将填充颜色的透明度设置为 0.1（alpha=?）。最终将生成的图片对象赋值给 fig3.</li>
</ol>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fig3 &lt;- ggplot(data = temp,aes(x=year,y=val,color=sex))+</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_line()+</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(size= 1.2)+</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_ribbon(aes(ymin=lower,ymax=upper,fill=sex),alpha=0.1)</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fig3</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 或者</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>fig3 <span class="ot">&lt;-</span> fig2 <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">fill =</span> sex), </span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">alpha =</span> <span class="fl">0.1</span>)</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>fig3</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-11-1.png" width="576" /></p>
<ol start="3" style="list-style-type: decimal">
<li>去除 fig3 图片中 95%UI 的颜色边框（提示：设置 color=NA），并大胆猜测 fill 和 color 参数的作用范围。然后赋值给 fig4。</li>
</ol>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>fig4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> temp,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>val,<span class="at">color=</span>sex))<span class="sc">+</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span> <span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower,<span class="at">ymax=</span>upper,<span class="at">fill=</span>sex),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">color=</span><span class="cn">NA</span>)</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>fig4</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-12-1.png" width="576" /></p>
<ol start="4" style="list-style-type: decimal">
<li>使用线图展示全球因艾滋病死亡人数的发展变化趋势，并用 ggsave 函数保存到工作路径中。</li>
</ol>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>fig5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>val,<span class="at">color=</span>sex))<span class="sc">+</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>fig5</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-13-1.png" width="576" /></p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(filename = &quot;AIDs线图.jpeg&quot;,width = 8,height = 6,dpi = 300)</span></span></code></pre></div>
</div>
</div>
<div id="图片的标题与注脚" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> 图片的标题与注脚</h2>
<div id="增加标题副标题注脚标签" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> 增加标题、副标题、注脚、标签</h3>
<p>前面我们生成了 fig4：</p>
<p>现在要在图片上方增加一个图片标题 (title)： Temporal trend of global incidence number of HIV; 副标题 subtitle: from 1990 to 2019; 在图片下方增加</p>
<p>注脚 (caption)： base on data from GBD 2019；最后打上一个”A” 的标签。</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>fig5 <span class="ot">&lt;-</span> fig4 <span class="sc">+</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Temporal trend of global incidence number of HIV&quot;</span>,</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;from 1990 to 2019&quot;</span>,</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">&quot;base on data from GBD 2019&quot;</span>,</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tag=</span><span class="st">&quot;A&quot;</span>)</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>fig5</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-14-1.png" width="576" /></p>
</div>
<div id="修改图片标题的字体大小位置" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> 修改图片标题的字体大小、位置</h3>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>fig5 <span class="ot">&lt;-</span> fig4 <span class="sc">+</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Temporal trend of global incidence number of HIV&quot;</span>,</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;from 1990 to 2019&quot;</span>,</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">&quot;base on data from GBD 2019&quot;</span>,</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tag=</span><span class="st">&quot;A&quot;</span>)<span class="sc">+</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="co"># h表示横向，just表示矫正；vjust表示垂直矫正。 0--&gt;1   左--&gt;右</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>fig5</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-15-1.png" width="576" /></p>
</div>
<div id="作业二" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> 作业二</h3>
<p>将 fig5 的图片标题，副标题字体大小均设定为 12，居中显示。</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>fig5 <span class="ot">&lt;-</span> fig4 <span class="sc">+</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Temporal trend of global incidence number of HIV&quot;</span>,</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;from 1990 to 2019&quot;</span>,</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">&quot;base on data from GBD 2019&quot;</span>,</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tag=</span><span class="st">&quot;A&quot;</span>)<span class="sc">+</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span><span class="co"># h表示横向，just表示矫正；vjust表示垂直矫正。 0--&gt;1   左--&gt;右</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>fig5</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-16-1.png" width="576" /></p>
</div>
</div>
<div id="坐标轴设定" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> 坐标轴设定</h2>
<div id="坐标轴标题修改" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> 坐标轴标题修改</h3>
<p>修改 fig5 坐标轴的标题, 将 Y 轴的设为 Incidence number，将 X 轴的标题去掉.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 方法一：</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="at">label =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="at">label=</span><span class="st">&quot;Incidence number&quot;</span>)</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-17-1.png" width="576" /></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 方法二：</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>,<span class="at">y=</span><span class="st">&quot;Incidence number&quot;</span>)</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-18-1.png" width="576" /></p>
<ul>
<li>坐标轴标题 (title) 字体大小设定</li>
</ul>
<p>字体大小一般都在 theme 里面设定：</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="at">label =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="at">label=</span><span class="st">&quot;Incidence number&quot;</span>)<span class="sc">+</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-19-1.png" width="576" /></p>
</div>
<div id="坐标轴尺度分段标签设定" class="section level3" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> 坐标轴尺度、分段、标签设定</h3>
<p>将 fig5 的 x 轴限度设置在 1990 年到 2019 年之间，间隔 5 年分段, 并改变每段标签为”year:1990”。</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&quot;Incidence number&quot;</span>)<span class="sc">+</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>),</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">&quot;year:&quot;</span>,</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>)))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-20-1.png" width="576" /></p>
</div>
<div id="坐标轴文字text大小旋转设定" class="section level3" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> 坐标轴文字（text）大小、旋转设定</h3>
<p>将上图 x 轴文字大小设定为 8，旋转为 45° 排列，同样在 theme 里面设定。</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&quot;Incidence number&quot;</span>)<span class="sc">+</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>),</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">&quot;year:&quot;</span>,</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,</span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">hjust=</span><span class="dv">1</span>,</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">vjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-21-1.png" width="576" /></p>
</div>
<div id="作业三" class="section level3" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> 作业三</h3>
<p>设定 fig5 的 y 轴，将它的限度设置在 0 到 2.5 million 之间，间隔为 0.5 million，尺度缩小 1 百万倍，同时 y 轴的标题变为 Incidence number(million)</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>fig5 <span class="sc">+</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&quot;Incidence number&quot;</span>)<span class="sc">+</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">hjust=</span><span class="dv">1</span>,</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">vjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>),</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">&quot;year:&quot;</span>,</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2500000</span>),</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">2500000</span>,<span class="at">by=</span><span class="dv">500000</span>),</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">paste</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">2.5</span>, <span class="at">by =</span> <span class="fl">0.5</span>), <span class="st">&quot;millon&quot;</span>)) </span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-22-1.png" width="576" /></p>
</div>
</div>
<div id="颜色尺度的调整" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> 颜色尺度的调整</h2>
<div id="手工调整颜色" class="section level3" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> 手工调整颜色</h3>
<p>手动调整颜色，将男性颜色设置为蓝色，女性颜色设置为红色</p>
<p>常用颜色代码：＃号后面 6 位数。<a href="https://www.cnblogs.com/biostat-yu/p/13839621.html" class="uri">https://www.cnblogs.com/biostat-yu/p/13839621.html</a></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-23-1.png" width="576" /></p>
</div>
<div id="使用-ggsci-代替-scale_fillcolor_manual" class="section level3" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> 使用 ggsci() 代替 scale_fill/color_manual</h3>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;ggsci&quot;)</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span> <span class="co"># 使用新英格兰配色</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_nejm</span>()</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-24-1.png" width="576" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_lancet</span>()<span class="sc">+</span> <span class="co"># 使用柳叶刀配色</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_lancet</span>()</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-25-1.png" width="576" /></p>
</div>
</div>
<div id="修改主题的其他元素-theme" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> 修改主题的其他元素： theme()</h2>
<p>前面已经提到，图片的 title, 轴的 title、 text，字体大小等都在 theme 里面设定，这里还可以修改其他元素：</p>
<ul>
<li>常用主题</li>
</ul>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># theme_bw()</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>fig7 <span class="ot">&lt;-</span> fig5<span class="sc">+</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&quot;Incidence number&quot;</span>)<span class="sc">+</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>),</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>fig7</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-26-1.png" width="576" /></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># theme_classic()</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>fig7<span class="sc">+</span><span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-27-1.png" width="576" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># theme_gray()</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>fig7<span class="sc">+</span><span class="fu">theme_gray</span>()</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-28-1.png" width="576" /></p>
<div id="图例-legend-的修改" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> 图例 legend 的修改</h3>
<div id="legend-可以放在图片的上下左右" class="section level4" number="3.7.1.1">
<h4><span class="header-section-number">3.7.1.1</span> legend 可以放在图片的上下左右：</h4>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 没有 legend</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>fig7<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="co"># 没有 legend</span></span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-29-1.png" width="576" /></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># legend 在上方</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>fig7<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-30-1.png" width="576" /></p>
<p><strong>legend 还可以在左边, 下方，右边，相应的参数取值为 legend.position =“left”,“bottom”,“right”。</strong></p>
</div>
<div id="legend-也可以放在图片的内部" class="section level4" number="3.7.1.2">
<h4><span class="header-section-number">3.7.1.2</span> legend 也可以放在图片的内部：</h4>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 比如在左下角：</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-31-1.png" width="576" /></p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 比如在右上角：</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-32-1.png" width="576" /></p>
<p>参数设定规则： legend.position = c(0,1) 中 c(0,1) 逗号前面的值设定 legend在 x 轴的相对位置；逗号后面的值设定 legend 在 y 轴的相对位置，另外，legend.justification 设定与 legend.position 一致即可。比如设定 legend 在图片<strong>内左下角，左上角，右上角，右下角分别为 c(0,0),c(0,1),c(1,0),c(1,1)。</strong></p>
</div>
</div>
<div id="作业四" class="section level3" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> 作业四</h3>
<p>将 fig5 的背景主题设置为 theme_bw()，并将 legend 设置在图片内正中间。</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>fig5<span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.justification=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-33-1.png" width="576" /></p>
</div>
</div>
<div id="总结" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> 总结</h2>
<ol style="list-style-type: decimal">
<li><p>画图之前查看数据；</p></li>
<li><p>想好用什么几何图形展示数据：点？线？柱？条？</p></li>
<li><p>设定 aes(), 指定 x、 y、 color、 fill 等参数的映射；</p></li>
<li><p>映射可通过画板全局设定，也可以在单个图层设定；</p></li>
<li><p>图层以 + 号连接；</p></li>
<li><p>坐标轴、颜色等尺度可以通过 scale_ 图层指定；</p></li>
<li><p>字体大小、位置、旋转等可以通过 theme 图层设定。</p></li>
</ol>
</div>
<div id="课后作业" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> 课后作业</h2>
<p>使用线图展示全球 HIV 的 DALY number 数据，要求：</p>
<ol style="list-style-type: decimal">
<li><p>有图片 title,caption,tag，</p></li>
<li><p>x 轴的尺度在 1990-2020 之间，间隔为 5 年， 45° 旋转</p></li>
<li><p>不同颜色表示男性、女性；</p></li>
<li><p>展示 95%UI，有透明度、边框颜色参数的设定；</p></li>
<li><p>设定 legend 位置为图片内，右下角；</p></li>
<li><p>使用 ggsave 导出 jpeg 格式， dpi=300。</p></li>
</ol>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/Global_HIV.csv&quot;</span>)</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>temp3 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;DALYs (Disability-Adjusted Life Years)&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;All ages&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause<span class="sc">==</span><span class="st">&quot;HIV/AIDS&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric<span class="sc">==</span><span class="st">&quot;Number&quot;</span>)</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 看看最大值有多大</span></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(temp3<span class="sc">$</span>val)</span></code></pre></div>
<pre><code>## [1] 58206725</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(temp3<span class="sc">$</span>upper) <span class="co">#72,576,395</span></span></code></pre></div>
<pre><code>## [1] 72576395</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘图</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>pic <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> temp3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>val,<span class="at">color=</span>sex))<span class="sc">+</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower,<span class="at">ymax=</span>upper,<span class="at">fill=</span>sex),</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha=</span><span class="fl">0.1</span>,</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>),</span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2020</span>,<span class="at">by=</span><span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">80000000</span>),</span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">80000000</span>,<span class="at">by=</span><span class="dv">20000000</span>),</span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">80</span>,<span class="at">by=</span><span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_nejm</span>()<span class="sc">+</span></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Temporal trend of golobal DALY number&quot;</span>,</span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;of HIV from 1990 to 2019&quot;</span>,</span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb258-19"><a href="#cb258-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;DALY number (million)&quot;</span>)<span class="sc">+</span></span>
<span id="cb258-20"><a href="#cb258-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb258-21"><a href="#cb258-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb258-22"><a href="#cb258-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb258-23"><a href="#cb258-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb258-24"><a href="#cb258-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">hjust =</span> <span class="dv">1</span>,<span class="at">vjust=</span><span class="dv">1</span>))</span>
<span id="cb258-25"><a href="#cb258-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-26"><a href="#cb258-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-27"><a href="#cb258-27" aria-hidden="true" tabindex="-1"></a>pic</span></code></pre></div>
<p><img src="03_ggplot2_files/figure-html/unnamed-chunk-34-1.png" width="576" /></p>
<!--chapter:end:03_ggplot2.Rmd-->
</div>
</div>
<div id="ggplot2图层语法与gbd数据可视化二" class="section level1" number="4">
<h1><span class="header-section-number">4</span> ggplot2图层语法与GBD数据可视化二</h1>
<div id="柱状图" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> 柱状图</h2>
<div id="geom_col-与-geom_bar-的区别" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> geom_col 与 geom_bar 的区别</h3>
<p>geom_col 或者 geom_bar是常用的绘制柱状图的方法，它们都是使用柱（条）的高度来展示数据，但是二者存在一些差异：</p>
<ol style="list-style-type: decimal">
<li><p>geom_col 必须要映射 x,y 两个参数，如：geom_col(data,aes(x,y))，其中， x 为每个柱（条）的位置， y 展示的每个柱子（条）的具体数值；</p></li>
<li><p>geom_bar 默认的参数为geom_bar(data,aes(x),stat=“count”)，这时候只能映射一个参数 x，不能设定 y。这里的 stat 是 statistics 的前面四个字母，是统计变换的意思。如果stat=“identity”（识别，不进行变换），则geom_bar 与 geom_col 完全相同</p></li>
</ol>
</div>
<div id="geom_colgeom_bar-的常用参数" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> geom_col/geom_bar 的常用参数</h3>
<p>我们展示 GBD 数据时, 一般不需要用到统计变换 stat=“count”, 多数情况下使用 geom_col 或者geom_bar(stat=“identity”)，需要指定 x 与 y 两个参数。</p>
<p>以全球艾滋病年龄标准化发病率为例, 我们想用柱状图展示 1990 年到 2019年 HIV 的年龄标准化患病率（间隔 5 年）：</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取数据</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/global_HIV.csv&quot;</span>,<span class="at">header=</span>T)</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 选择数据并且画图</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(cause<span class="sc">==</span><span class="st">&quot;HIV/AIDS&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sex<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;Incidence&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;Age-standardized&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(metric<span class="sc">==</span><span class="st">&quot;Rate&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year<span class="sc">%in%</span><span class="fu">seq</span>(<span class="dv">1990</span>,<span class="dv">2019</span>,<span class="at">by=</span><span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year=</span><span class="fu">factor</span>(year)) <span class="sc">|&gt;</span> <span class="co"># 将年份设置为因子</span></span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sex=</span><span class="fu">factor</span>(sex,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>))) <span class="sc">|&gt;</span></span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>val,<span class="at">fill=</span>sex))<span class="sc">+</span></span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_bar(stat = &quot;identity&quot;,position=position_dodge())</span></span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>,<span class="at">width =</span> <span class="fl">0.8</span>)</span>
<span id="cb259-17"><a href="#cb259-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-18"><a href="#cb259-18" aria-hidden="true" tabindex="-1"></a>fig1</span></code></pre></div>
<p><img src="04_ggplot2%E7%BB%A7%E7%BB%AD_files/figure-html/unnamed-chunk-1-1.png" width="576" />
这里我们使用管道操作直接将数据筛选后用管道符 “|&gt;” 连接后续的 ggplot() 函数，这样做的好处是可以避免生成多余的变量。这里需要注意的是，管道操作是用管道符”|&gt;” 连接的，而 ggplot() 之后，图层是用”+“进行连接。</p>
<div id="position" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> position</h4>
</div>
</div>
<div id="课堂作业-1给柱状图加个误差" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> 课堂作业 1：给柱状图加个误差</h3>
</div>
</div>
<div id="ggplot2-的分面系统" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> ggplot2 的分面系统</h2>
<div id="facet_wrapfacet_gridfacet_nested" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> facet_wrap/facet_grid/facet_nested</h3>
</div>
<div id="facet_wrap" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> facet_wrap</h3>
</div>
<div id="facet_gridfacet_nested" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> facet_grid/facet_nested</h3>
</div>
</div>
<div id="图形的组合" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> 图形的组合</h2>
<div id="按照行" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> 按照行</h3>
</div>
<div id="按照列" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> 按照列</h3>
</div>
<div id="增加图片的其他元素plot_annotation" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> 增加图片的其他元素（plot_annotation）</h3>
</div>
<div id="增加空格plot_spacer" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> 增加空格（plot_spacer）</h3>
</div>
<div id="通过-layout-控制图片的位置-designlayout" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> 通过 layout 控制图片的位置： design=layout</h3>
</div>
<div id="legend-的调整收集标签" class="section level3" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> legend 的调整（收集标签）</h3>
</div>
</div>
<div id="课后作业-1" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> 课后作业</h2>
<ol style="list-style-type: decimal">
<li>绘制下面图形。（提示：使用课堂作业相同的数据， coord_flip() 可以翻转 x-y 轴； 1990 的数值设置为负）</li>
</ol>
<p><img src="images/050z.png" width="90%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>绘制下图（提示：使用 patchwork 改写 fig5）
<img src="images/050z.png" width="90%" style="display: block; margin: auto;" /></li>
</ol>
<!--chapter:end:04_ggplot2继续.Rmd-->
</div>
</div>
<div id="gbd-数据可视化--绘制地图" class="section level1" number="5">
<h1><span class="header-section-number">5</span> GBD 数据可视化 -绘制地图</h1>
<div id="sf包" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> sf包</h2>
<div id="读取文件" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> 读取文件</h3>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/世界国家/世界国家.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `世界国家&#39; from data source 
##   `D:\OneDrive - b.sxmu.edu.cn\03-yh学习\00-小论文\03-GBD\GBD_yh_test\data\世界国家\世界国家.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 247 features and 10 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -180 ymin: -90 xmax: 180 ymax: 83.63
## CRS:           NA</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/世界国家/世界国家.shp&quot;</span>) <span class="co"># 推荐读取方式</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(map)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(map2)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div id="查看shp文件" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> 查看shp文件</h3>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(map)</span></code></pre></div>
<pre><code>##  [1] &quot;OBJECTID&quot;   &quot;NAME&quot;       &quot;FENAME&quot;    
##  [4] &quot;FCNAME&quot;     &quot;SOC&quot;        &quot;POP&quot;       
##  [7] &quot;ELEMID&quot;     &quot;SHAPE_LENG&quot; &quot;SHAPE_AREA&quot;
## [10] &quot;ID1&quot;        &quot;geometry&quot;</code></pre>
</div>
<div id="设定地图文件的坐标参考系" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> 设定地图文件的坐标参考系</h3>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(map,<span class="dv">4326</span>)</span></code></pre></div>
</div>
<div id="简单绘制世界地图" class="section level3" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> 简单绘制世界地图</h3>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>map)<span class="sc">+</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-4-1.png" width="576" /></p>
</div>
</div>
<div id="利用-ggplot2-绘制地图" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> 利用 ggplot2 绘制地图</h2>
<div id="读取-gbd-数据" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> 读取 GBD 数据</h3>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>GBD <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/national HIV.csv&quot;</span>)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GBD)</span></code></pre></div>
<pre><code>##  [1] &quot;measure&quot;  &quot;location&quot; &quot;sex&quot;      &quot;age&quot;     
##  [5] &quot;cause&quot;    &quot;metric&quot;   &quot;year&quot;     &quot;val&quot;     
##  [9] &quot;upper&quot;    &quot;lower&quot;</code></pre>
</div>
<div id="读取-location-数据" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> 读取 location 数据</h3>
<p>GBD 的国家（或地区）名与地图上的国家（或地区）名并不能完全匹配，因此通过两个数据的地区直接连接会产生大量的 NA 值。 location 数据是我已经整理好的，用于连接 GBD 和地图数据的中间数据。它有三列，分别为 location,location2,location3。其中 location 与 GBD 的 location 完全一致;location2 与 map 数据的 FENAME 列完全一致； location3 与 map 数据的 NAME 列完全一致。</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取 location 数据</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/location.csv&quot;</span>)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(location)</span></code></pre></div>
<pre><code>## [1] &quot;location&quot;  &quot;location2&quot; &quot;location3&quot;</code></pre>
<p>我们可以通过这个 location 数据实现 GBD 数据与 map 数据的连接合并。</p>
</div>
<div id="数据的合并联接" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> 数据的合并联接</h3>
<p>tidyverse 包中的 join 函数可以实现两个数据的合并联接。根据目的不同，join 函数可以分为： left_join(),inner_join(),full_join() 等多个函数。它们的具体功能可以参考本次教案 join 函数讲解 ppt。</p>
<p>首先，我们合并 GBD 数据与 location 数据：</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>GBD <span class="ot">&lt;-</span> <span class="fu">left_join</span>(GBD,location,<span class="at">by=</span><span class="st">&quot;location&quot;</span>)</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GBD)</span></code></pre></div>
<pre><code>##  [1] &quot;measure&quot;   &quot;location&quot;  &quot;sex&quot;       &quot;age&quot;      
##  [5] &quot;cause&quot;     &quot;metric&quot;    &quot;year&quot;      &quot;val&quot;      
##  [9] &quot;upper&quot;     &quot;lower&quot;     &quot;location2&quot; &quot;location3&quot;</code></pre>
<p>然后，我们再通过 location2/location3 与 map 数据合并。</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(map,GBD,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;NAME&quot;</span><span class="ot">=</span><span class="st">&quot;location3&quot;</span>))</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df &lt;- na.omit(df) # 直接删除不太好, 南极洲都被删除了</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## Simple feature collection with 2657 features and 21 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -180 ymin: -90 xmax: 180 ymax: 83.63
## Geodetic CRS:  WGS 84
## First 10 features:
##    OBJECTID NAME FENAME FCNAME  SOC POP ELEMID
## 1         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 2         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 3         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 4         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 5         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 6         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 7         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 8         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 9         1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
## 10        1 &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt; &lt;NA&gt;   0      0
##    SHAPE_LENG SHAPE_AREA ID1 measure
## 1         154      27.51   1  Deaths
## 2         154      27.51   1  Deaths
## 3         154      27.51   1  Deaths
## 4         154      27.51   1  Deaths
## 5         154      27.51   1  Deaths
## 6         154      27.51   1  Deaths
## 7         154      27.51   1  Deaths
## 8         154      27.51   1  Deaths
## 9         154      27.51   1  Deaths
## 10        154      27.51   1  Deaths
##                      location    sex              age
## 1                        Guam   Male Age-standardized
## 2                        Guam Female Age-standardized
## 3                        Guam   Both Age-standardized
## 4                 South Sudan   Male Age-standardized
## 5                 South Sudan Female Age-standardized
## 6                 South Sudan   Both Age-standardized
## 7  Taiwan (Province of China)   Male Age-standardized
## 8  Taiwan (Province of China) Female Age-standardized
## 9  Taiwan (Province of China)   Both Age-standardized
## 10                  Palestine   Male Age-standardized
##       cause metric year     val    upper   lower
## 1  HIV/AIDS   Rate 1990 1.62013  3.48241 0.38473
## 2  HIV/AIDS   Rate 1990 0.18891  0.43887 0.04390
## 3  HIV/AIDS   Rate 1990 0.95707  2.04443 0.22247
## 4  HIV/AIDS   Rate 1990 4.83394 15.15071 1.76827
## 5  HIV/AIDS   Rate 1990 5.73258 16.86650 2.20436
## 6  HIV/AIDS   Rate 1990 5.24118 16.24245 1.96614
## 7  HIV/AIDS   Rate 1990 0.05882  0.06455 0.05331
## 8  HIV/AIDS   Rate 1990 0.02084  0.02287 0.01900
## 9  HIV/AIDS   Rate 1990 0.04046  0.04352 0.03762
## 10 HIV/AIDS   Rate 1990 0.08099  0.09625 0.06313
##    location2                       geometry
## 1       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 2       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 3       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 4       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 5       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 6       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 7       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 8       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 9       &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...
## 10      &lt;NA&gt; MULTIPOLYGON (((-88.73 48.3...</code></pre>
</div>
<div id="绘制属性地图" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> 绘制属性地图</h3>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;Incidence&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&quot;Both&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">group=</span>NAME,<span class="at">fill=</span>val),<span class="at">color=</span><span class="fu">alpha</span>(<span class="st">&quot;white&quot;</span>,<span class="fl">0.2</span>))</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>fig1</span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-9-1.png" width="576" /></p>
</div>
<div id="尺度变换限制经纬度获得小地图" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> 尺度变换：限制经纬度获得小地图</h3>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> fig1<span class="sc">+</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>,<span class="dv">0</span>))</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>fig2</span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-10-1.png" width="576" /></p>
<p>后续可以通过 patchwork 进行图片的拼接。</p>
</div>
<div id="颜色变换" class="section level3" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> 颜色变换</h3>
<div id="scale_fill_gradient2" class="section level4" number="5.2.6.1">
<h4><span class="header-section-number">5.2.6.1</span> scale_fill_gradient2()</h4>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>fig2<span class="sc">+</span><span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mid =</span> <span class="st">&quot;yellow&quot;</span>,<span class="at">midpoint =</span> <span class="dv">250</span>,</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">high =</span> <span class="st">&quot;darkred&quot;</span>)</span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-11-1.png" width="576" /></p>
</div>
<div id="scale_fill_distiller" class="section level4" number="5.2.6.2">
<h4><span class="header-section-number">5.2.6.2</span> scale_fill_distiller()</h4>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>fig2<span class="sc">+</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette=</span><span class="st">&quot;Spectral&quot;</span>,<span class="co"># 色盘</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name=</span><span class="st">&quot;ASR&quot;</span>)</span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-12-1.png" width="576" /></p>
</div>
<div id="scale_fill_manual-离散颜色" class="section level4" number="5.2.6.3">
<h4><span class="header-section-number">5.2.6.3</span> scale_fill_manual() 离散颜色</h4>
<p>包括前面讲过的 scale_fill_lancet 等函数也可以用在这里。但是我们的数据val 本身是离散的，需要进行数据变换，转换成分类变量，然后转化为因子，才能用离散颜色。</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>fig2<span class="sc">+</span><span class="fu">scale_fill_manual</span>()</span></code></pre></div>
<p>简书上有关于地图配色的文章，讲得挺完善的，大家可以去学习一下：<a href="https:/www.jianshu.com/p/d85aa0b4fb1c">https: /www.jianshu.com/p/d85aa0b4fb1c</a></p>
</div>
</div>
</div>
<div id="课后作业-2" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> 课后作业</h2>
<ol style="list-style-type: decimal">
<li>文档里有一份胃癌的数据，请绘制疾病地图，展示 2019 年男性胃癌年龄标准化发病率的空间分布</li>
</ol>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取GBD数据</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>GBD <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/stomach cancer.csv&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/location.csv&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>GBD <span class="ot">&lt;-</span> <span class="fu">left_join</span>(GBD,location,<span class="at">by=</span><span class="st">&quot;location&quot;</span>)</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GBD)</span></code></pre></div>
<pre><code>##  [1] &quot;measure&quot;   &quot;location&quot;  &quot;sex&quot;       &quot;age&quot;      
##  [5] &quot;cause&quot;     &quot;metric&quot;    &quot;year&quot;      &quot;val&quot;      
##  [9] &quot;upper&quot;     &quot;lower&quot;     &quot;location2&quot; &quot;location3&quot;</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取地图数据</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/世界国家/世界国家.shp&quot;</span>)</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(map)</span></code></pre></div>
<pre><code>##  [1] &quot;OBJECTID&quot;   &quot;NAME&quot;       &quot;FENAME&quot;    
##  [4] &quot;FCNAME&quot;     &quot;SOC&quot;        &quot;POP&quot;       
##  [7] &quot;ELEMID&quot;     &quot;SHAPE_LENG&quot; &quot;SHAPE_AREA&quot;
## [10] &quot;ID1&quot;        &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并，筛选</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> map <span class="sc">|&gt;</span> </span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(GBD,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;NAME&quot;</span><span class="ot">=</span> <span class="st">&quot;location3&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">1990</span>) <span class="sc">|&gt;</span> </span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&quot;Male&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;Age-standardized&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;Incidence&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 画图</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span> </span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>val))<span class="sc">+</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette=</span><span class="st">&quot;Spectral&quot;</span>) </span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-15-1.png" width="576" /></p>
<ol start="2" style="list-style-type: decimal">
<li>使用 facet 分面系统，同时展示 1990 和 2019 两年男性胃癌不同测量指标（包括 incidence,precalence 等）的全球分布。</li>
</ol>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取GBD数据</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>GBD <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/stomach cancer.csv&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/location.csv&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>GBD <span class="ot">&lt;-</span> <span class="fu">left_join</span>(GBD,location,<span class="at">by=</span><span class="st">&quot;location&quot;</span>)</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GBD)</span></code></pre></div>
<pre><code>##  [1] &quot;measure&quot;   &quot;location&quot;  &quot;sex&quot;       &quot;age&quot;      
##  [5] &quot;cause&quot;     &quot;metric&quot;    &quot;year&quot;      &quot;val&quot;      
##  [9] &quot;upper&quot;     &quot;lower&quot;     &quot;location2&quot; &quot;location3&quot;</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(GBD<span class="sc">$</span>cause)</span></code></pre></div>
<pre><code>## [1] &quot;Stomach cancer&quot;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(GBD<span class="sc">$</span>measure)</span></code></pre></div>
<pre><code>## [1] &quot;Deaths&quot;                                
## [2] &quot;Prevalence&quot;                            
## [3] &quot;DALYs (Disability-Adjusted Life Years)&quot;
## [4] &quot;YLDs (Years Lived with Disability)&quot;    
## [5] &quot;Incidence&quot;                             
## [6] &quot;YLLs (Years of Life Lost)&quot;</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取地图数据</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/世界国家/世界国家.shp&quot;</span>)</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(map)</span></code></pre></div>
<pre><code>##  [1] &quot;OBJECTID&quot;   &quot;NAME&quot;       &quot;FENAME&quot;    
##  [4] &quot;FCNAME&quot;     &quot;SOC&quot;        &quot;POP&quot;       
##  [7] &quot;ELEMID&quot;     &quot;SHAPE_LENG&quot; &quot;SHAPE_AREA&quot;
## [10] &quot;ID1&quot;        &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并，筛选</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> map <span class="sc">|&gt;</span> </span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(GBD,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;NAME&quot;</span><span class="ot">=</span> <span class="st">&quot;location3&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2019</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">&quot;Male&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;Age-standardized&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year=</span><span class="fu">factor</span>(year)) <span class="sc">|&gt;</span> </span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">measure=</span><span class="fu">factor</span>(measure,</span>
<span id="cb297-9"><a href="#cb297-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Incidence&quot;</span>,<span class="st">&quot;Prevalence&quot;</span>,<span class="st">&quot;Deaths&quot;</span>,</span>
<span id="cb297-10"><a href="#cb297-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;YLDs (Years Lived with Disability)&quot;</span>,</span>
<span id="cb297-11"><a href="#cb297-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;YLLs (Years of Life Lost)&quot;</span>,<span class="st">&quot;Deaths&quot;</span>),</span>
<span id="cb297-12"><a href="#cb297-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Incidence&quot;</span>,<span class="st">&quot;Prevalence&quot;</span>,<span class="st">&quot;Deaths&quot;</span>,</span>
<span id="cb297-13"><a href="#cb297-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;YLDs (Years Lived with Disability)&quot;</span>,</span>
<span id="cb297-14"><a href="#cb297-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;YLLs (Years of Life Lost)&quot;</span>,<span class="st">&quot;Deaths&quot;</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb297-15"><a href="#cb297-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span></code></pre></div>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 画图</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span> </span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>val))<span class="sc">+</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(measure<span class="sc">~</span>year)<span class="sc">+</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette=</span><span class="st">&quot;Spectral&quot;</span>)  </span></code></pre></div>
<p><img src="05_%E5%9C%B0%E5%9B%BE%E7%BB%98%E5%88%B6_files/figure-html/unnamed-chunk-17-1.png" width="576" /></p>
<ol start="3" style="list-style-type: decimal">
<li>说说如何实现下面图的绘制？</li>
</ol>
<p><img src="images/050z.png" width="90%" style="display: block; margin: auto;" /></p>
<!--chapter:end:05_地图绘制.Rmd-->
</div>
</div>
<div id="joinpoint-联结点回归模型" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Joinpoint 联结点回归模型</h1>
<div id="实战-数据处理" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> 实战-数据处理</h2>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取并查看数据</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Global_HIV.csv&quot;</span>,<span class="at">header =</span> T)</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>measure)</span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>location)</span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>sex)</span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>age)</span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>cause)</span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>metric)</span>
<span id="cb299-10"><a href="#cb299-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>year)</span></code></pre></div>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 筛选数据：</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>number <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;HIV/AIDS&quot;</span>,<span class="st">&quot;Syphilis&quot;</span>,<span class="st">&quot;Chlamydial infection&quot;</span>,</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Gonococcal infection&quot;</span>,<span class="st">&quot;Trichomoniasis&quot;</span>,</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Genital herpes&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;All ages&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric<span class="sc">==</span><span class="st">&quot;Number&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;Incidence&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val=</span><span class="fu">round</span>(val,<span class="dv">0</span>),    <span class="co">#将数据变为整数</span></span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper=</span><span class="fu">round</span>(upper,<span class="dv">0</span>),</span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower=</span><span class="fu">round</span>(lower,<span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb300-12"><a href="#cb300-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cause,sex,year)    <span class="co">#重排序，非常重要</span></span>
<span id="cb300-13"><a href="#cb300-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-14"><a href="#cb300-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-15"><a href="#cb300-15" aria-hidden="true" tabindex="-1"></a>ASR <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb300-16"><a href="#cb300-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;HIV/AIDS&quot;</span>,<span class="st">&quot;Syphilis&quot;</span>,<span class="st">&quot;Chlamydial infection&quot;</span>,</span>
<span id="cb300-17"><a href="#cb300-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Gonococcal infection&quot;</span>,<span class="st">&quot;Trichomoniasis&quot;</span>,</span>
<span id="cb300-18"><a href="#cb300-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Genital herpes&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb300-19"><a href="#cb300-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age<span class="sc">==</span><span class="st">&quot;Age-standardized&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb300-20"><a href="#cb300-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(measure<span class="sc">==</span><span class="st">&quot;Incidence&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb300-21"><a href="#cb300-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(metric<span class="sc">==</span><span class="st">&quot;Rate&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb300-22"><a href="#cb300-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se=</span>(upper<span class="sc">-</span>lower)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fl">1.96</span>)) <span class="sc">|&gt;</span>  <span class="co">#生成se</span></span>
<span id="cb300-23"><a href="#cb300-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cause,sex,year)    <span class="co">#重排序，非常重要</span></span></code></pre></div>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 写出数据</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(number,<span class="st">&quot;data/number.csv&quot;</span>,<span class="at">row.names =</span> F)</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(ASR,<span class="st">&quot;data/ASR.csv&quot;</span>,<span class="at">row.names =</span> F)</span></code></pre></div>
<p><img src="images/050z.png" width="90%" style="display: block; margin: auto;" /></p>
<!--chapter:end:06_jointpoint.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>GBD 笔记总结</strong>" was written by 杨 弘. It was last built on 2022-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
